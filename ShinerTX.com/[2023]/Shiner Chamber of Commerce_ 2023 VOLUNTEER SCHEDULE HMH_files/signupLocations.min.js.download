SUGApp.directive("signupLocation",function(){return{restrict:"EA",transclude:!0,scope:{locationid:"@locationid",slotid:"@slotid",locationtype:"@locationtype",autoupdateslots:"@autoupdateslots",onLocationSelection:"&?",search:"@search"},templateUrl:"/view/templates/signuplocation/signuplocation-button.html",replace:!0,controller:["$scope","SUGUtilities","$timeout","$location","$modal","$compile","$window",function(t,o,e,s,n,i,d){t.searchEnabled=0<=["true","1"].indexOf(t.search.toString()),d.quickPop=function(e,o){$.get(e,function(e){e=i(e)(t);angular.element(document.querySelector("#quickBox")).html(""),angular.element(document.querySelector("#quickBox")).append(e),$("#quickBox").dialog("option","title",o),$("#quickBox").dialog("open").height("auto")})},t.streetaddress="",t.addressDetails="",void 0!==t.slotid&&(t.slotid=t.slotid.split(","));var d=angular.element("#"+t.locationtype+"locationid"),a=(void 0===t.locationid&&0<Number(d.val())?t.locationid=angular.copy(d.val()):void 0===t.locationid&&(t.locationid=""),t.geoinfo={},t.geoinfo.mid=window.userdef.memberid,t.geoinfo.locationid=t.locationid,t.geoinfo.slotid=t.slotid,t.geoinfo.init=!0,t.geoinfo.gapi=void 0!==window.globalcfg.gapi?window.globalcfg.gapi:"",t.geoinfo.autoupdateslots=t.autoupdateslots,t.gapi=function(){o.APISyncCall("post","","gapi","g.getGlobalVariable",15e3).then(function(e){if(a(e))return t.geoinfo.gapi="",!1;e=o.lowerCaseKeys(e),t.geoinfo.gapi=e.data.data.variable,e=document.createElement("script");e.src="api/js?libraries=geometry,places&key="+t.geoinfo.gapi,e.async=!0,e.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(e)})},function(e){return void 0===(e=o.lowerCaseKeys(e)).data||!e.data.success}),l=(t.displaySignupLocationModal=function(e){n.open({templateUrl:"/view/templates/signuplocation/signuplocation-modal.html",controller:l,resolve:{geoinfo:function(){return e},searchEnabled:function(){return t.searchEnabled}}}).result.then(function(e){if(e.success){try{0===e.data.locationid&&(e.data.locationid=""),t.geoinfo.locationid=e.data.locationid;angular.element("#"+t.locationtype+"locationid").val(t.geoinfo.locationid),t.locationname=e.data.name;var o=angular.element("#"+t.locationtype+"locationname");""==o.val()&&o.val(t.locationname),angular.isDefined(t.onLocationSelection)&&t.onLocationSelection({locationObj:e.data.selectedAddress})}catch(e){t.locationid=""}try{t.slotid=e.data.slotid}catch(e){t.slotid=""}}})},t.signupLocationModal=function(){var e=t.geoinfo;t.displaySignupLocationModal(e)},["$scope","$modalInstance","geoinfo","$timeout","SUGUtilities","$window","$filter","searchEnabled",function(b,e,c,o,n,t,s,i){t.userdef.parentid==t.userdef.ownerid&&Number(0!==t.userdef.parentid)?c.mid=t.userdef.parentid:c.mid=window.userdef.memberid,(c.locationid||c.slotid)&&(c.init=!0),c.shouldclose=!1,c.deleteid=0,b.searchEnabled=i,b.obj={},b.obj.details={},b.obj.streetaddress="Test",b.obj.userlocations=[],b.obj.selectedAddress={},b.obj.defaultselection="Select an Address",b.obj.selection=angular.copy(b.obj.defaultselection),b.obj.parentSelected=!1,b.obj.parentSelection={},b.obj.errormessages={name:"Please enter a name",address1:"Please enter the street address",city:"Please enter your city",state:"Enter your state",zipcode:"Enter your zip",country:"Please enter your country"},b.obj.add="Add New Address",b.obj.edit="Edit Address",b.obj.addEditMessage="Add New Address",b.obj.showAddressForm=!1,b.obj.validation=!1,b.obj.editmode=!1,b.loc={},b.locSpinr=!1,b.getLocationsByMember=function(){n.APISyncCall("post","",{memberid:c.mid},"s.getLocationsByMember",15e3).then(function(e){if(d(e))return b.obj.userlocations=[],b.obj.showAddressForm=!1;e=n.lowerCaseKeys(e).data.data;e.length?(b.obj.userlocations=s("orderBy")(e,["name"],!1),1==c.init&&(""!==c.locationid&&void 0!==c.locationid?b.setLocation():c.init&&c.slotid&&!c.locationid&&b.getLocationBySlot(c))):(b.obj.userlocations=[],b.obj.showAddressForm=!1)})},b.assignLocationToSlot=function(){var e=[],e="string"==typeof c.slotid?[c.slotid]:c.slotid;n.APISyncCall("post","",{memberid:c.mid,locationid:c.locationid,slotids:e},"s.assignLocationToSlot",15e3).then(function(e){if(d(e))return!1;n.lowerCaseKeys(e).data.data;c.shouldclose&&b.ok()})},b.getLocationBySlot=function(s){n.APISyncCall("post","",{memberid:s.mid,slotids:[s.slotid]},"s.getLocationBySlot",15e3).then(function(e){if(d(e))return!1;var o,t=n.lowerCaseKeys(e).data.data;for(o in t)t[o].slotid==s.slotid&&(c.locationid=t[o].locationid,b.setLocation())})},b.setLocation=function(){for(var e in b.obj.userlocations){if(0<c.deleteid&&b.obj.userlocations[e].locationid===c.deleteid){b.obj.selection=angular.copy(b.obj.defaultselection),b.obj.selectedAddress={},c.locationid="",c.init=!1,c.deleteid=!1;break}if(c.locationid==b.obj.userlocations[e].locationid){b.getSelection(b.obj.userlocations[e]),c.init=!1;break}}},b.createSignupLocation=function(s){n.APISyncCall("post","",s,"s.createSignupLocation",15e3).then(function(e){var o,t;if(d(e))return o="Invalid Response.",o=(t=n.lowerCaseKeys(e)).data.message[0]||"An error has occurred during Save.",n.showMagnificAlert(o,"","","Error"),!1;t=n.lowerCaseKeys(e),s.locationid=t.data.data,c.locationid=s.locationid,b.buildMenuTitle(s),c.shouldclose=!0,c.slotid&&"1"==c.autoupdateslots?b.assignLocationToSlot():b.ok()})},b.saveAddress=function(n,e){try{!0===b.obj.parentSelected&&b.setAddress(b.obj.parentSelection)}catch(e){}var o,t=!1;if("object"==typeof n)for(var s in n)n.hasOwnProperty(s)&&"undefined"!==(o=n[s])&&""!==o&&(t=!0);t||(b.clearform(!(t=!1)),n=b.obj.selectedAddress,c.locationid=0,n.locationid=0,c.shouldclose=!0,c.slotid&&"1"==c.autoupdateslots?b.assignLocationToSlot():b.ok());var i,d,a,l,r=!1;if(t)for(var s in b.obj.validation=!0,b.obj.errormessages)if(b.obj.errormessages.hasOwnProperty(s)&&(r=b.errorExists(s)))break;!r&&b.obj.validation&&(b.obj.validation=!1,""===(i=angular.copy(n)).coordinate||null==i.coordinate?i.coordinate="":((d="")!==i.address1&&(d=d+i.address1+", "),""!==i.address2&&(d=d+i.address2+", "),""!==i.city&&(d=d+i.city+", "),""!==i.zipcode&&(d=d+i.zipcode+", "),""!==i.country&&(d+=i.country),a=new google.maps.Geocoder,l="",a.geocode({address:d},function(e,o){var t,s;"OK"==o?(t=e[0].geometry.location.lat(),e=e[0].geometry.location.lng(),(l=t+","+e)!==i.coordinate&&""!==l&&(t=l.split(","),e=i.coordinate.split(","),s=100,t[0]=Math.round(t[0]*s)/s,e[0]=Math.round(e[0]*s)/s,t[1]=Math.round(t[1]*s)/s,e[1]=Math.round(e[1]*s)/s,t[0]===e[0]&&t[1]===e[1]||(n.coordinate=l))):console.warn("Geocode was not successful for the following reason: "+o)})),n.memberid=c.mid,null==n.coordinate&&(n.coordinate=""),void 0===e?b.createSignupLocation(n):(c.locationid=n.locationid,b.buildMenuTitle(n),c.shouldclose=!0,c.slotid&&"1"==c.autoupdateslots?b.assignLocationToSlot():b.ok()))},b.deleteSignupLocation=function(o){n.APISyncCall("post","",o,"s.deleteSignupLocation",15e3).then(function(e){if(d(e))return!1;c.deleteid=o.locationid;n.lowerCaseKeys(e);b.setLocation(),b.getLocationsByMember()})},b.deleteAddressConfirmation=function(o){n.showConfirmationModal({txtConfirmationTitle:"Are you sure?",txtConfirmationMessage:'<div class="spacer-sm"></div>Are you sure you want to delete this address? The address link will be removed from any sign ups using the address.<div class="spacer-sm"></div>'+o.name+"<br>"+o.address1+" "+o.address2+"<br>"+o.city+", "+o.state+", "+o.zipcode,lblYesButton:"Yes, Delete",lblCancelButton:"Cancel"},function(e){o.memberid=c.mid,b.deleteSignupLocation(o),o.locationid==b.obj.selectedAddress.locationid&&b.clearform(!0)})},b.clearform=function(e){var o,t=["coordinate","locationid","memberid","lat","lng","coordinate","name","address1","address2","city","state","zipcode","country"];for(o in t){var s=t[o];b.obj.selectedAddress[s]="","locationid"==s&&delete b.obj.selectedAddress.locationid}e&&"object"==typeof b.obj.selectedAddress&&(b.obj.selectedAddress.gapiaddress="")},b.getLocationsByMember(),b.buildMenuTitle=function(e){b.obj.selection="",angular.equals(e,"No Address")?(b.obj.selection="Select an Address",b.clearform(!0),b.obj.showAddressForm=!1):(""!==b.obj.selectedAddress.name&&(b.obj.selection=b.obj.selection+b.obj.selectedAddress.name+", "),""!==b.obj.selectedAddress.address1&&(b.obj.selection=b.obj.selection+b.obj.selectedAddress.address1+", "),""!==b.obj.selectedAddress.address2&&(b.obj.selection=b.obj.selection+b.obj.selectedAddress.address2+", "),""!==b.obj.selectedAddress.city&&(b.obj.selection=b.obj.selection+b.obj.selectedAddress.city+", "),""!==b.obj.selectedAddress.zipcode&&(b.obj.selection=b.obj.selection+b.obj.selectedAddress.zipcode+", "),""!==b.obj.selectedAddress.country&&(b.obj.selection=b.obj.selection+b.obj.selectedAddress.country))},b.setSelection=function(e){b.clearform(!0),b.obj.showAddressForm=!0,b.obj.selectedAddress=angular.copy(e),b.buildMenuTitle(e)},b.editAddress=!1,b.editAddressConfirmation=function(o){n.showConfirmationModal({txtConfirmationTitle:"Are you sure?",txtConfirmationMessage:'<div class="spacer-sm"></div>Are you sure you want to edit this address? All sign ups using this address link will also be updated.<div class="spacer-sm"></div>'+o.name+"<br>"+o.address1+" "+o.address2+"<br>"+o.city+", "+o.state+", "+o.zipcode,lblYesButton:"Yes, Continue",lblCancelButton:"Cancel"},function(e){b.editAddress=!0,b.setSelection(o)},function(){b.editAddress=!1})},b.grabObject=function(e){b.obj.parentSelected=!0,b.obj.parentSelection=e},b.getSelection=function(e){b.obj.parentSelected=!1;b.clearform(!0),b.obj.showAddressForm=!1,b.obj.selectedAddress=angular.equals(e,"No Address")?{}:angular.copy(e),b.buildMenuTitle(e)},b.deleteAdd=function(e){b.deleteAddressConfirmation(e)};var d=function(e){return void 0===(e=n.lowerCaseKeys(e)).data||!e.data.success};b.errorExists=function(e){return!!b.obj.validation&&!(b.obj.selectedAddress[e]||"")},b.addNewAddress=function(){b.editAddress=!1,b.obj.parentSelected=!1;b.clearform(!0),b.obj.showAddressForm=!0,b.obj.selection=angular.copy(b.obj.defaultselection),b.obj.selectedAddress={}},b.setAddressFields=function(e){b.clearform(!1),b.obj.showAddressForm=!0,b.obj.selectedAddress.lat=e.geometry.location.lat(),b.obj.selectedAddress.lng=e.geometry.location.lng(),b.obj.selectedAddress.coordinate=b.obj.selectedAddress.lat+","+b.obj.selectedAddress.lng;var o,t,s=["route","place","address2"],n=["address1","name","address2"],i=["subpremise","locality","administrative_area_level_1","postal_code","country"],d=["address2","city","state","zipcode","country"],a="",l=e.address_components,r=void 0!==e.name?e.name:"",c="";for(t in b.obj.selectedAddress.name=r,l)"street_number"==(c=l[t].types[0])?a=l[t].short_name:c==s[0]&&(o=a+" "+l[t].short_name,b.obj.selectedAddress[n[0]]=o,b.obj.geocodeaddress=angular.copy(o),o!==r)&&(b.obj.selectedAddress[n[1]]=r);for(t in l)for(var u in c=l[t].types[0],i){var m=i[u],p="";c==m&&(p="country"!==m?l[t].short_name:l[t].long_name,b.obj.selectedAddress[d[u]]=p)}b.buildMenuItem()},b.$watch(function(){return t.locationDetails},function(e,o){if(null!=e)try{void 0!==e.address_components&&(b.obj.parentSelected=!1,b.setAddressFields(e))}catch(e){}}),b.locSpinr=!1,o(function(){var e,o,t,s;t="19px",s="14px",e={lines:15,length:8,width:2,radius:8,corners:1,left:s=void 0!==e?e:s,top:t=void 0!==o?o:t,rotate:0,direction:1,speed:1,color:"#ef9934",trail:60,shadow:!(o="locationSpinner"),hwaccel:!1,className:"spinner",zIndex:2e9},s=document.getElementById(o),new Spinner(e).spin(s)},1),b.stopSpinner=function(){o(function(){b.locSpinr=!1},1)},b.ok=function(){c.name=b.obj.selectedAddress.name,c.selectedAddress=angular.copy(b.obj.selectedAddress),b.clearform(!0),b.obj.showAddressForm=!1,t.locationDetails=null,e.close({success:!0,data:c,message:"success"})},b.cancel=function(){b.clearform(!0),b.obj.showAddressForm=!1,t.locationDetails=null,e.dismiss({success:!1,data:"",message:"cancel"})}}])}]}}),SUGApp.directive("ngAutocomplete",function(){return{require:"ngModel",scope:{ngModel:"=",details:"=",charlen:"@",blur:"=",focus:"="},link:function(t,s,e,o){var n,i=new google.maps.places.AutocompleteSessionToken,d=(t.charLen=void 0===t.charLen||""===t.charlen?4:parseInt(t.charLen),t.$watch("ngModel",function(e,o){void 0!==e&&e.length>=t.charlen?(setTimeout(function(){document.getElementById("GoogleAutocomplete").blur()},t.blur),void 0===t.gPlace&&d(),setTimeout(function(){document.getElementById("GoogleAutocomplete").focus()},t.focus)):void 0!==t.gPlace&&(google.maps.event.removeListener(n),google.maps.event.clearInstanceListeners(s[0]),t.gPlace=void 0,n=void 0,angular.element(document.querySelector(".pac-container")).remove())}),function(){t.gPlace=new google.maps.places.Autocomplete(s[0],{sessiontoken:i}),n=google.maps.event.addListener(t.gPlace,"place_changed",function(){var e=t.gPlace.getPlace();void 0!==e&&void 0!==e.address_components&&t.$apply(function(){t.details=e,o.$setViewValue(s.val()),window.locationDetails=e})})});o.$render=function(){var e=o.$viewValue;s.val(e)}}}});
SUGApp.directive("signupVirtualLocation",function(){return{restrict:"EA",transclude:!0,scope:{virtuallocationid:"@virtuallocationid",onLocationSelection:"&?"},templateUrl:"/view/templates/signuplocation/signupvirtuallocation-button.html",replace:!0,controller:["$scope","SUGUtilities","$modal",function(o,e,i){o.str={icon:{virtual:"glyphicon glyphicon-facetime-video"}};var n=!(o.virtualinfo={virtuallocationid:o.virtuallocationid,meetingid:o.virtuallocationid?" ":""}),a=(o.displaySignupVirtualLocationModal=function(){function t(){i.open({templateUrl:"/view/templates/signuplocation/signupvirtuallocation-modal.html?v=1565966734",controller:a,resolve:{virtualinfo:function(){return o.virtualinfo}}}).result.then(function(i){i.virtualinfo&&(o.virtualinfo=i.virtualinfo,angular.isDefined(o.onLocationSelection))&&o.onLocationSelection({locationObj:{virtualinfo:o.virtualinfo}})})}o.virtuallocationid&&!n?e.APISyncCall("post","",{virtuallocationid:o.virtuallocationid},"w.getVirtualLocation",15e3).then(function(i){e.ajaxResultInvalid(i)||(n=!0,i=e.lowerCaseKeys(i),o.virtualinfo=i.data.data,t())}):t()},["$scope","$modalInstance","virtualinfo","SUGUtilities","$q","errorService",function(o,e,i,t,n,a){o.virtuallocvm={errorServiceInstance:a.newInstance(),isProcessing:!1,str:{btnadd:i.meetingid?"Update":"Add",btnremove:"Remove",img:"/images/integrations/zoom.png",examplemeeting:"e.g. 123-456-789"},showRemove:!!i.meetingid,virtualinfoform:{virtuallocationid:i.virtuallocationid,type:i.type||"Zoom",meetingid:i.meetingid||""},save:function(){var i,t;i=o.virtuallocvm.virtualinfoform,t=n.defer(),(i={virtuallocationid:i.virtuallocationid,meetingid:i.meetingid?i.meetingid.toString().trim():"",type:"Zoom"}).meetingid.length?new RegExp(/^[\d]{9,11}$/).test(i.meetingid.replace(/\s/g,"").replace(/-/g,""))||t.reject("The meeting ID can be 9, 10, or 11 digits"):i.type="",t.resolve(i),t.promise.then(function(i){e.close({virtualinfo:i})},function(i){o.virtuallocvm.errorServiceInstance.setError("zoom-meeting-id",i)})},remove:function(){e.close({virtualinfo:{virtuallocationid:i.virtuallocationid,meetingid:"",type:""}})},dismiss:function(){e.dismiss(!1)}}}])}]}});
//# sourceMappingURL=signupLocations.min.js.map

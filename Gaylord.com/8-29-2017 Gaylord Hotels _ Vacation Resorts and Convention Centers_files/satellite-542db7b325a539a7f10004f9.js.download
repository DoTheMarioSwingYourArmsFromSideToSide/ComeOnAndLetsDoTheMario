if (typeof(window.dataLayer) !== "undefined") {
    var usedResLink = false;
    var urlQS = window.dataLayer.page_url_query_string;
    if (typeof(urlQS) !== 'undefined' && (urlQS.indexOf('resvlink') > -1 || urlQS.indexOf('resLinkData') > -1)) {
        usedResLink = true;
    }
    var thirdPartyId = window.dataLayer.mr_prof_id_alternate;
    if (typeof(thirdPartyId) !== "undefined") {
    /** Temporary comment out for profile stitching error on edge servers
		thirdPartyId = thirdPartyId.replace('.',''); **/
    }
	
	var theDL = window.dataLayer;

    window.targetPParams = function() {
        return {
					"at_property": "c72849c6-2a3c-8a3b-bf17-94885baf8879",
					"brandCode": theDL.prop_brand_code,
					"cookie_mi_site": theDL.cookie_mi_visitor,
					"clustCode": theDL.clustCode,            
					"custAssoc": theDL.custAssoc,         
					"creditcard_holder_rcr": theDL.mr_prof_cc_us_rcr,
					"env_is_aries": "false",
					"env_is_prod": theDL.isProd,
          "env_server_id": theDL.cookie_mi_site,
					"env_site_id": theDL.env_site_id,
					"isRewardsRedemption": theDL.res_isRedemption,
					"isProd": theDL.isProd,
					"marshaCode": theDL.prop_marsha_code,
					"mbox3rdPartyId": thirdPartyId,
					"mboxPC": theDL.cookie_mi_visitor,
					"mboxSession": theDL.sessionId, 
					"memState": theDL.memState,
					"mr_prof_customer_assocations": theDL.custAssoc,
					"mr_prof_cc_us_rcr": theDL.mr_prof_cc_us_rcr,
					"mr_prof_authentication_state": theDL.memState,
					"mrshaCode": theDL.prop_marsha_code,
					"mrLevel": theDL.mrLevel,
					"mr_prof_member_program_level": theDL.mrLevel,
					"numberOfPages":theDL.numberOfPages,
					"nmbNights": theDL.nmbNights,
					"numRooms": theDL.numRooms,
					"numGuests": theDL.numGuestsPerRoom,
					"prof_state": theDL.prof_state,
					"profile": {
						"SttBhvSeg": theDL.SttBhvSeg,
						"SttBusProf": theDL.SttBusProf,
						"SttDC": theDL.SttDC,
						"SttLeisProf": theDL.SttLeisProf,
						"mr_prof_cc_us_rcr": theDL.mr_prof_cc_us_rcr,
						"mr_prof_customer_assocations": theDL.custAssoc
					},
					"prop_marsha_code": theDL.prop_marsha_code,
					"res_isRedemption": theDL.res_isRedemption,
					"res_stay_length": theDL.nmbNights,
					"res_market_prefix": theDL.res_market_prefix,
					"res_rate_program": theDL.res_rate_program,
					"res_rooms_per_night": theDL.numRooms,
					"search_cluster_code": theDL.clustCode,
					"search_guests_per_room": theDL.numGuestsPerRoom,
					"search_advnc_purch_days": theDL.search_advance_purchase_days,
					"search_availability_search": theDL.search_availability_search,
					"search_dest": theDL.srchDest,
					"search_destination_city_state_country": theDL.srchDest,
					"search_list_marsha": theDL.search_list_marsha,
					"search_list_marshas_on_page": theDL.search_list_marsha,
					"siteID": theDL.env_site_id,
					"used_resLink": usedResLink
        };
    };
}

var mboxCopyright = "Copyright 1996-2015. Adobe Systems Incorporated. All rights reserved.";
var TNT = TNT || {};

TNT.a = (function() {
    return {
        nestedMboxes: [],

        b: {
            companyName: "Test&amp;Target",
            isProduction: true,
            adminUrl: "http://admin12.testandtarget.omniture.com/admin",
            clientCode: "marriottinternationa",
            serverHost: "marriottinternationa.tt.omtrdc.net",
            mboxTimeout: 10000,
            mboxLoadedTimeout: 100,
            mboxFactoryDisabledTimeout: 30 * 60,
            bodyPollingTimeout: 16,
            bodyHidingEnabled: false,
            bodyHiddenStyle: "body{opacity:0}",
            sessionExpirationTimeout: 31 * 60,
            experienceManagerDisabledTimeout: 30 * 60,
            experienceManagerTimeout: 5000,
            visitorApiTimeout: 500,
            visitorApiPageDisplayTimeout: 500,
            overrideMboxEdgeServer: false,
            overrideMboxEdgeServerTimeout: 31 * 60,
            tntIdLifetime: 7776000,
            crossDomain: "enabled",
            trafficDuration: 10368000,
            trafficLevelPercentage: 100,
            clientSessionIdSupport: true,
            clientTntIdSupport: true,
            passPageParameters: true,
            usePersistentCookies: true,
            crossDomainEnabled: true,
            crossDomainXOnly: false,
            imsOrgId: "664516D751E565010A490D4C@AdobeOrg",
            globalMboxName: "target-global-mbox",
            globalMboxLocationDomId: "",
            globalMboxAutoCreate: true,
            experienceManagerPluginUrl: "//cdn.tt.omtrdc.net/cdn/target.js",
            siteCatalystPluginName: "tt",
            mboxVersion: 62,
            optoutEnabled: false,
            secureOnly: false,
            mboxIsSupportedFunction: function() {
                return true;
            },
            parametersFunction: function() {
                return "";
            },
            cookieDomainFunction: function() {
                return mboxCookiePageDomain();
            }
        },

        c: {
            d: "mboxPage",
            e: "mboxMCGVID",
            f: "mboxMCGLH",
            g: "mboxAAMB",
            h: "mboxMCAVID",
            i: "mboxMCSDID",
            j: "mboxCount",
            k: "mboxHost",
            l: "mboxFactoryId",
            m: "mboxPC",
            n: "screenHeight",
            o: "screenWidth",
            p: "browserWidth",
            q: "browserHeight",
            r: "browserTimeOffset",
            s: "colorDepth",
            t: "mboxXDomain",
            u: "mboxURL",
            v: "mboxReferrer",
            w: "mboxVersion",
            x: "mbox",
            y: "mboxId",
            z: "mboxDOMLoaded",
            A: "mboxTime",
            B: "scPluginVersion"
        },

        C: {
            D: "mboxDisable",
            E: "mboxSession",
            F: "mboxEnv",
            G: "mboxDebug"
        },

        H: {
            D: "disable",
            E: "session",
            m: "PC",
            I: "level",
            J: "check",
            G: "debug",
            K: "em-disabled",
            L: "mboxEdgeServer"
        },

        M: {
            N: "default",
            O: "mbox",
            P: "mboxImported-",
            Q: 60000,
            R: "mboxDefault",
            S: "mboxMarker-",
            T: 250,
            B: 1,
            U: "mboxedge",
            V: "tt.omtrdc.net"
        }
    }
}());

TNT.a.W = {};

(function(X) {
    var Y = {}.toString;

    function Z(_) {
        return _ === void(0);
    }

    function ab(_) {
        return _ === null;
    }

    function bb(_) {
        if (Z(_) || ab(_)) {
            return true;
        }

        return _.length === 0;
    }

    function cb(_) {
        return Y.call(_) === '[object Function]';
    }

    function db(_) {
        return Y.call(_) === '[object Array]';
    }

    function eb(_) {
        return Y.call(_) === '[object String]';
    }

    function fb(_) {
        return Y.call(_) === '[object Object]';
    }

    function gb(hb, ib) {
        var jb = hb.length,
            kb = -1;

        while (++kb < jb) {
            ib(hb[kb]);
        }
    }

    X.Z = Z;
    X.ab = ab;
    X.bb = bb;
    X.cb = cb;
    X.db = db;
    X.eb = eb;
    X.fb = fb;
    X.gb = gb;
}(TNT.a.W));


mboxUrlBuilder = function(lb, mb) {
    this.lb = lb;
    this.mb = mb;
    this.nb = [];
    this.ob = function(u) {
        return u;
    };
    this.pb = null;
};

mboxUrlBuilder.prototype = {
    constructor: mboxUrlBuilder,

    addNewParameter: function(qb, _) {
        this.nb.push({
            name: qb,
            value: _
        });

        return this;
    },

    addParameterIfAbsent: function(qb, _) {
        if (!_) {
            return;
        }

        for (var rb = 0; rb < this.nb.length; rb++) {
            var sb = this.nb[rb];

            if (sb.name === qb) {
                return this;
            }
        }

        this.checkInvalidCharacters(qb);

        return this.addNewParameter(qb, _);
    },

    addParameter: function(qb, _) {
        this.checkInvalidCharacters(qb);

        for (var rb = 0; rb < this.nb.length; rb++) {
            var sb = this.nb[rb];

            if (sb.name === qb) {
                sb.value = _;

                return this;
            }
        }

        return this.addNewParameter(qb, _);
    },

    addParameters: function(nb) {
        if (!nb) {
            return this;
        }

        for (var rb = 0; rb < nb.length; rb++) {
            var tb = nb[rb];
            var ub = tb.indexOf('=');

            if (ub === -1 || ub === 0) {
                continue;
            }

            this.addParameter(tb.substring(0, ub), tb.substring(ub + 1, tb.length));
        }

        return this;
    },

    setServerType: function(vb) {
        this.wb = vb;
    },

    setBasePath: function(pb) {
        this.pb = pb;
    },

    setUrlProcessAction: function(xb) {
        this.ob = xb;
    },

    buildUrl: function() {
        var yb = TNT.a.b.secureOnly,
            zb = yb ? 'https:' : '',
            Ab = TNT.a.Bb(this.lb),
            Cb = this.pb ? this.pb : '/m2/' + this.mb + '/mbox/' + this.wb,
            u = zb + '//' + Ab + Cb,
            Db = [];

        for (var rb = 0; rb < this.nb.length; rb++) {
            var sb = this.nb[rb];

            Db.push(encodeURIComponent(sb.name) + '=' + encodeURIComponent(sb.value));
        }

        u += u.indexOf('?') != -1 ? '&' + Db.join('&') : '?' + Db.join('&');

        return this.Eb(this.ob(u));
    },

    getParameters: function() {
        return this.nb;
    },

    setParameters: function(nb) {
        this.nb = nb;
    },

    clone: function() {
        var Fb = new mboxUrlBuilder(this.lb, this.mb);

        Fb.setServerType(this.wb);
        Fb.setBasePath(this.pb);
        Fb.setUrlProcessAction(this.ob);

        for (var rb = 0; rb < this.nb.length; rb++) {
            Fb.addParameter(this.nb[rb].name, this.nb[rb].value);
        }

        return Fb;
    },

    Eb: function(Gb) {
        return Gb.replace(/\"/g, '&quot;').replace(/>/g, '&gt;');
    },

    checkInvalidCharacters: function(qb) {
        var Hb = new RegExp('(\'|")');

        if (Hb.exec(qb)) {
            throw "Parameter '" + qb + "' contains invalid characters";
        }
    }
};




TNT.a.Ib = function() {
    var Jb = [],
        Kb = 0,
        Lb = [];

    function Mb(Nb, Ob) {
        Kb += 1;
        Jb[Nb] = Ob;

        Pb();
    }

    function Pb() {
        var jb = Lb.length,
            kb = -1,
            Qb;

        if (Kb !== Jb.length || !Lb.length) {
            return;
        }

        while (++kb < jb) {
            Qb = Lb[kb];
            Qb.fn.apply(Qb.ctx, Jb);
        }
    }

    return {
        Rb: function() {
            var Nb = Jb.length;

            Jb[Jb.length] = null;

            return function() {
                Mb(Nb, [].slice.call(arguments));
            };
        },

        Sb: function(cb, context) {
            Lb.push({
                fn: cb,
                ctx: context
            });
            Pb();
        }
    };
};

(function(X, W, c, b, Tb) {
    var Ub = new RegExp("\\|MCMID\\|"),
        Vb = 'vst.',
        Wb = Vb + 'trk',
        Xb = Vb + 'trks';

    function Yb(Zb, _) {
        return encodeURIComponent(Zb) + '=' + encodeURIComponent(_);
    }

    function _b(ac) {
        var bc,
        cc = function(Zb) {
            return Vb + Zb;
        };

        if (!W.cb(ac.getCustomerIDs)) {
            return [];
        }

        bc = ac.getCustomerIDs();

        if (!W.fb(bc)) {
            return [];
        }

        return X.dc(bc, [], cc);
    }

    function ec(ac, fc) {
        var gc = ac.trackingServer,
            hc = ac.trackingServerSecure;

        if (gc) {
            fc.push(Yb(Wb, gc));
        }

        if (hc) {
            fc.push(Yb(Xb, hc));
        }
    }

    function ic(ac, fc) {
        fc.push.apply(fc, _b(ac));
    }

    function jc(Ob) {
        var fc = [];

        W.gb(Ob, function(hb) {
            fc.push(hb[0]);
        });

        return fc;
    }

    function kc(lc) {
        return !W.bb(lc.value);
    }

    function mc(Ib, ac, nc, Zb) {
        var oc;

        if (!W.cb(ac[nc])) {
            return;
        }

        oc = Ib.Rb();




        ac[nc](function(_) {
            oc({
                key: Zb,
                value: _
            });
        }, true);
    }

    function pc(Ib, ac, qc) {
        qc(Ib, ac, 'getMarketingCloudVisitorID', c.e);
        qc(Ib, ac, 'getAudienceManagerBlob', c.g);
        qc(Ib, ac, 'getAnalyticsVisitorID', c.h);
        qc(Ib, ac, 'getAudienceManagerLocationHint', c.f);
    }

    function rc(Ib, ac, sc, tc, uc) {
        if (tc) {
            window.clearTimeout(sc.id);

            uc({
                optout: tc,
                params: []
            });

            vc();

            return;
        }

        pc(Ib, ac, mc);

        Ib.Sb(function() {
            if (sc.done) {
                return;
            }

            var c = jc([].slice.call(arguments)),
                fc = [];

            window.clearTimeout(sc.id);

            W.gb(c, function(lc) {
                if (kc(lc)) {
                    fc.push(Yb(lc.key, lc.value));
                }
            });

            ic(ac, fc);
            ec(ac, fc);

            uc({
                optout: tc,
                params: fc
            });

            vc();
        });
    }

    function wc(xc) {
        var ac;

        if (W.bb(xc) || W.Z(window.Visitor) || !W.cb(window.Visitor.getInstance)) {
            return null;
        }

        ac = window.Visitor.getInstance(xc);

        if (W.Z(ac) || W.ab(ac) || !ac.isAllowed()) {
            return null;
        }

        return ac;
    }



    function yc() {
        return !W.ab(wc(b.imsOrgId));
    }

    function zc() {
        var ac = wc(b.imsOrgId);

        if (W.ab(ac)) {
            return false;
        }

        if (W.Z(ac.cookieName)) {
            return false;
        }

        if (!W.cb(ac.cookieRead)) {
            return false;
        }

        var Ac = ac.cookieRead(ac.cookieName);

        if (W.bb(Ac)) {
            return false;
        }

        return Ub.test(Ac);
    }

    function Bc(ac, Cc) {
        return Cc && W.cb(ac.isOptedOut) && !W.Z(window.Visitor.OptOut);
    }

    function Dc(Cc, uc) {
        var xc = b.imsOrgId,
            Ec = b.visitorApiTimeout,
            Ib = Tb(),
            sc = {
                id: NaN,
                done: false
            },
            ac;

        ac = wc(xc);

        if (W.ab(ac)) {
            uc(null);

            return;
        }

        Fc();

        sc.id = window.setTimeout(function() {
            sc.done = true;

            uc(null);

            vc();
        }, Ec);

        if (Bc(ac, Cc)) {
            ac.isOptedOut(function(tc) {
                rc(Ib, ac, sc, tc, uc);
            }, window.Visitor.OptOut.GLOBAL, true);
        } else {
            rc(Ib, ac, sc, false, uc);
        }
    }

    function Gc(ac, nc, Zb, Hc) {
        if (ac[nc]) {
            var _ = ac[nc]();

            if (_) {
                Hc.push(Yb(Zb, _));
            }
        }
    }

    function Ic() {
        var ac = wc(b.imsOrgId),
            fc = [];

        Gc(ac, 'getMarketingCloudVisitorID', c.e, fc);
        Gc(ac, 'getAudienceManagerBlob', c.g, fc);
        Gc(ac, 'getAnalyticsVisitorID', c.h, fc);
        Gc(ac, 'getAudienceManagerLocationHint', c.f, fc);

        ic(ac, fc);
        ec(ac, fc);

        return fc;
    }

    function Jc(x) {
        var xc = b.imsOrgId,
            mb = b.clientCode,
            ac = wc(xc);

        if (W.ab(ac) || !W.cb(ac.getSupplementalDataID)) {
            return '';
        }

        return ac.getSupplementalDataID('mbox:' + mb + ':' + x);
    }

    function Fc() {
        if (!b.bodyHidingEnabled) {
            return;
        }

        if (!b.globalMboxAutoCreate) {
            return
        }

        var Kc = document.getElementsByTagName('head')[0];
        var Lc = document.createElement('style');
        Lc.type = 'text/css';
        Lc.id = 'at-id-body-style';

        if (Lc.styleSheet) {
            Lc.styleSheet.cssText = css;
        } else {
            Lc.appendChild(document.createTextNode(b.bodyHiddenStyle));
        }

        if (Kc) {
            Kc.appendChild(Lc);
        }
    }

    function vc() {
        if (!b.bodyHidingEnabled) {
            return;
        }

        if (!b.globalMboxAutoCreate) {
            return
        }

        window.setTimeout(function() {
            var Kc = document.getElementsByTagName('head')[0];
            var Lc = document.getElementById('at-id-body-style');

            if (Kc && Lc) {
                Kc.removeChild(Lc);
            }
        }, b.visitorApiPageDisplayTimeout);
    }

    X.yc = yc;
    X.zc = zc;
    X.Dc = Dc;
    X.Ic = Ic;
    X.Jc = Jc;
}(TNT.a, TNT.a.W, TNT.a.c, TNT.a.b, TNT.a.Ib));

mboxStandardFetcher = function() {};

mboxStandardFetcher.prototype = {
    constructor: mboxStandardFetcher,

    getType: function() {
        return 'standard';
    },

    fetch: function(Mc) {
        Mc.setServerType(this.getType());

        document.write('<' + 'scr' + 'ipt src="' + Mc.buildUrl() + '"><' + '\/scr' + 'ipt>');
    },

    cancel: function() {}
};

mboxAjaxFetcher = function() {};

mboxAjaxFetcher.prototype = {
    constructor: mboxAjaxFetcher,

    getType: function() {
        return 'ajax';
    },

    fetch: function(Mc) {
        Mc.setServerType(this.getType());

        var Kc = document.getElementsByTagName('head')[0],
            Nc = document.createElement('script');

        Nc.src = Mc.buildUrl();

        Kc.appendChild(Nc);
    },

    cancel: function() {}
};

(function(X) {
    function Oc() {}

    Oc.prototype = {
        constructor: Oc,

        getType: function() {
            return 'ajax';
        },

        fetch: function(Mc) {
            Mc.setServerType(this.getType());

            document.write('<' + 'scr' + 'ipt src="' + Mc.buildUrl() + '"><' + '\/scr' + 'ipt>');
        },

        cancel: function() {}
    };

    X.Oc = Oc;
}(TNT.a));

mboxMap = function() {
    this.Pc = {};
    this.Qc = [];
};

mboxMap.prototype = {
    constructor: mboxMap,

    put: function(Zb, _) {
        if (!this.Pc[Zb]) {
            this.Qc[this.Qc.length] = Zb;
        }

        this.Pc[Zb] = _;
    },

    get: function(Zb) {
        return this.Pc[Zb];
    },

    remove: function(Zb) {
        var Rc = [];
        this.Pc[Zb] = undefined;


        for (var i = 0; i < this.Qc.length; i++) {
            if (this.Qc[i] !== Zb) {
                Rc.push(this.Qc[i]);
            }
        }

        this.Qc = Rc;
    },

    each: function(xb) {
        for (var rb = 0; rb < this.Qc.length; rb++) {
            var Zb = this.Qc[rb];
            var _ = this.Pc[Zb];

            if (_) {
                var fc = xb(Zb, _);

                if (fc === false) {
                    break;
                }
            }
        }
    },

    isEmpty: function() {
        return this.Qc.length === 0;
    }
};

mboxList = function() {
    this.Sc = [];
};

mboxList.prototype = {
    constructor: mboxList,

    add: function(Tc) {
        if (!Tc) {
            return;
        }

        this.Sc.push(Tc);
    },

    get: function(x) {
        var fc = new mboxList();

        for (var rb = 0; rb < this.Sc.length; rb++) {
            var Tc = this.Sc[rb];

            if (Tc.getName() === x) {
                fc.add(Tc);
            }
        }

        return fc;
    },

    getById: function(Nb) {
        return this.Sc[Nb];
    },

    length: function() {
        return this.Sc.length;
    },

    each: function(xb) {
        var W = TNT.a.W;

        if (!W.cb(xb)) {
            throw 'Action must be a function, was: ' + typeof(xb);
        }

        for (var rb = 0; rb < this.Sc.length; rb++) {
            xb(this.Sc[rb]);
        }
    }
};

mboxSignaler = function(Uc) {
    this.Uc = Uc;
};

mboxSignaler.prototype = {
    constructor: mboxSignaler,

    signal: function(Vc, x) {
        if (!this.Uc.isEnabled()) {
            return;
        }

        var Wc = mboxSignaler.Xc(),
            Yc = this.Zc(this.Uc._c(x));

        Wc.appendChild(Yc);

        var Ob = [].slice.call(arguments, 1),
            Tc = this.Uc.create(x, Ob, Yc),
            Mc = Tc.getUrlBuilder();

        Mc.addParameter(TNT.a.c.d, mboxGenerateId());
        Tc.setFetcher(new mboxAjaxFetcher());
        Tc.load();
    },

    Zc: function(ad) {
        var fc = document.createElement('div');

        fc.id = ad;
        fc.style.visibility = 'hidden';
        fc.style.display = 'none';

        return fc;
    }
};

mboxSignaler.Xc = function() {
    return document.body;
};





mboxLocatorDefault = function(bd) {
    this.bd = bd;

    document.write('<div id="' + this.bd + '" style="visibility:hidden;display:none">&nbsp;<\/div>');
};

mboxLocatorDefault.prototype = {
    constructor: mboxLocatorDefault,

    locate: function() {
        var cd = 1,
            dd = document.getElementById(this.bd);

        while (dd) {
            if (dd.nodeType === cd && dd.className && dd.className.indexOf('mboxDefault') !== -1) {
                return dd;
            }

            dd = dd.previousSibling;
        }

        return null;
    },

    force: function() {

        var ed = document.getElementById(this.bd),
            fd = document.createElement('div');

        fd.className = 'mboxDefault';

        if (ed) {
            ed.parentNode.insertBefore(fd, ed);
        }

        return fd;
    }
};

mboxLocatorNode = function(dd) {
    this.dd = dd;
};

mboxLocatorNode.prototype = {
    constructor: mboxLocatorNode,

    locate: function() {
        return typeof(this.dd) === 'string' ? document.getElementById(this.dd) : this.dd;
    },

    force: function() {
        return null;
    }
};

mboxOfferContent = function() {
    this.gd = function() {};
};

mboxOfferContent.prototype = {
    constructor: mboxOfferContent,

    show: function(Tc) {
        var fc = Tc.showContent(document.getElementById(Tc.getImportName()));

        if (fc === 1) {
            this.gd();
        }

        return fc;
    },

    setOnLoad: function(gd) {
        this.gd = gd;
    }
};

mboxOfferAjax = function(hd) {
    this.hd = hd;
    this.gd = function() {};
};

mboxOfferAjax.prototype = {
    constructor: mboxOfferAjax,

    setOnLoad: function(gd) {
        this.gd = gd;
    },

    show: function(Tc) {
        var id = document.createElement('div'),
            fc;

        id.id = Tc.getImportName();
        id.innerHTML = this.hd;

        fc = Tc.showContent(id);

        if (fc === 1) {
            this.gd();
        }

        return fc;
    }
};

mboxOfferDefault = function() {
    this.gd = function() {};
};

mboxOfferDefault.prototype = {
    constructor: mboxOfferDefault,

    show: function(Tc) {
        var fc = Tc.hide();

        if (fc === 1) {
            this.gd();
        }

        return fc;
    },

    setOnLoad: function(gd) {
        this.gd = gd;
    }
};

mboxCookieManager = function(qb, jd) {
    this.qb = qb;
    this.kd = TNT.a.H.J;
    this.ld = TNT.a.b.crossDomainXOnly;
    this.md = TNT.a.H.D;
    this.nd = TNT.a.b.usePersistentCookies;
    this.od = new mboxMap();


    this.jd = jd === '' || jd.indexOf('.') === -1 ? '' : '; domain=' + jd;

    this.loadCookies();
};

mboxCookieManager.prototype = {
    constructor: mboxCookieManager,

    isEnabled: function() {
        this.setCookie(this.kd, 'true', 60);
        this.loadCookies();

        return this.getCookie(this.kd) == 'true';
    },

    setCookie: function(qb, _, pd) {
        if (typeof qb == 'undefined' || typeof _ == 'undefined' || typeof pd == 'undefined') {
            return;
        }

        var qd = Math.ceil(pd + new Date().getTime() / 1000),
            rd = mboxCookieManager.sd(qb, encodeURIComponent(_), qd);

        this.od.put(qb, rd);
        this.saveCookies();
    },

    getCookie: function(qb) {
        var rd = this.od.get(qb);

        return rd ? decodeURIComponent(rd.value) : null;
    },

    deleteCookie: function(qb) {
        this.od.remove(qb);
        this.saveCookies();
    },

    getCookieNames: function(td) {
        var ud = [];

        this.od.each(function(qb, rd) {
            if (qb.indexOf(td) === 0) {
                ud[ud.length] = qb;
            }
        });

        return ud;
    },

    saveCookies: function() {
        var vd = this,
            wd = [],
            xd = 0;

        this.od.each(function(qb, rd) {
            if (!vd.ld || qb === vd.md) {
                wd[wd.length] = mboxCookieManager.yd(rd);

                if (xd < rd.expireOn) {
                    xd = rd.expireOn;
                }
            }
        });

        var zd = new Date(xd * 1000);
        var Db = [];

        Db.push(this.qb, '=', wd.join('|'));

        if (vd.nd) {
            Db.push('; expires=', zd.toGMTString());
        }

        Db.push('; path=/', this.jd);

        document.cookie = Db.join("");
    },

    loadCookies: function() {
        var Ad = mboxCookieManager.Bd(this.qb),
            Cd = mboxCookieManager.Dd(Ad),
            Ed = Math.ceil(new Date().getTime() / 1000);

        this.od = new mboxMap();

        for (var rb = 0; rb < Cd.length; rb++) {
            var rd = mboxCookieManager.Fd(Cd[rb]);

            if (Ed > rd.expireOn) {
                continue;
            }

            this.od.put(rd.name, rd);
        }
    }
};

mboxCookieManager.yd = function(rd) {
    return rd.name + '#' + rd.value + '#' + rd.expireOn;
};

mboxCookieManager.Fd = function(Y) {
    var Db = Y.split('#');

    return mboxCookieManager.sd(Db[0], Db[1], Db[2]);
};

mboxCookieManager.sd = function(qb, _, qd) {
    return {
        name: qb,
        value: _,
        expireOn: qd
    };
};

mboxCookieManager.Bd = function(qb) {
    var result = new RegExp('(^|; )' + encodeURIComponent(qb) + '=([^;]*)').exec(document.cookie);

    return result ? result[2] : null;
};

mboxCookieManager.Dd = function(Y) {
    if (!Y) {
        return [];
    }

    return Y.split('|');
};

mboxSession = function(Gd, Hd, Id, Jd, Kd) {
    var Ld = window.mboxForceSessionId;
    this.Id = Id;
    this.Jd = Jd;
    this.Kd = Kd;
    this.ad = typeof(Ld) !== 'undefined' ? Ld : mboxGetPageParameter(Hd, true);
    this.ad = this.ad || Kd.getCookie(Id) || Gd;

    this.Kd.setCookie(Id, this.ad, Jd);
};

mboxSession.prototype = {
    constructor: mboxSession,

    getId: function() {
        return this.ad;
    },

    forceId: function(Md) {
        this.ad = Md;

        this.Kd.setCookie(this.Id, this.ad, this.Jd);
    }
};

mboxPC = function(Id, Jd, Kd) {
    var Nd = window.mboxForcePCId;
    this.Id = Id;
    this.Jd = Jd;
    this.Kd = Kd;
    this.ad = typeof(Nd) != 'undefined' ? Nd : Kd.getCookie(Id);

    if (this.ad) {
        Kd.setCookie(Id, this.ad, Jd);
    }
};

mboxPC.prototype = {
    constructor: mboxPC,

    getId: function() {
        return this.ad;
    },

    forceId: function(Md) {
        if (this.ad === Md) {
            return false;
        }

        this.ad = Md;
        this.Kd.setCookie(this.Id, this.ad, this.Jd);

        return true;
    }
};

(function(X, W, H, b, M) {
    var Od = new RegExp(".*\\.(\\d+)_\\d+");

    function Bb(Qd) {
        var Rd = Od.exec(Qd);

        if (Rd && Rd.length === 2) {
            return M.U + Rd[1] + '.' + M.V;
        }

        return '';
    }

    function Sd(Kd, Td) {
        var Ab = Bb(Td);

        if (!W.bb(Ab)) {
            Kd.setCookie(H.L, Ab, b.overrideMboxEdgeServerTimeout);
        }
    }

    function Ud(Vd, Kd) {
        this.Vd = Vd;
        this.Kd = Kd;

        Sd(Kd, Vd.getId());
    }

    Ud.prototype = {
        constructor: Ud,

        getId: function() {
            return this.Vd.getId();
        },

        forceId: function(Md) {
            if (!this.Vd.forceId(Md)) {
                return false;
            }

            Sd(this.Kd, Md);

            return true;
        }
    };

    X.Ud = Ud;
}(TNT.a, TNT.a.W, TNT.a.H, TNT.a.b, TNT.a.M));
mboxGetPageParameter = function(qb, Wd) {
    Wd = Wd || false;

    var Xd;

    if (Wd) {
        Xd = new RegExp("\\?[^#]*" + qb + "=([^\&;#]*)", "i");
    } else {
        Xd = new RegExp("\\?[^#]*" + qb + "=([^\&;#]*)");
    }

    var fc = null;
    var Yd = Xd.exec(document.location);

    if (Yd && Yd.length >= 2) {
        fc = Yd[1];
    }

    return fc;
};

mboxCookiePageDomain = function() {
    var jd = (/([^:]*)(:[0-9]{0,5})?/).exec(document.location.host)[1];
    var Zd = /[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/;

    if (!Zd.exec(jd)) {
        var _d = (/([^\.]+\.[^\.]{3}|[^\.]+\.[^\.]+\.[^\.]{2})$/).exec(jd);

        if (_d) {
            jd = _d[0];

            if (jd.indexOf("www.") === 0) {
                jd = jd.substr(4);
            }
        }
    }

    return jd ? jd : "";
};

mboxShiftArray = function(ae) {
    var fc = [];

    for (var rb = 1; rb < ae.length; rb++) {
        fc[fc.length] = ae[rb];
    }

    return fc;
};

mboxGenerateId = function() {

    var s = [],
        hex = '0123456789abcdef';

    for (var i = 0; i < 36; i++) {
        s[i] = hex.substr(Math.floor(Math.random() * 0x10), 1);
    }

    s[14] = '4';

    s[19] = hex.substr((s[19] & 0x3) | 0x8, 1);
    s[8] = s[13] = s[18] = s[23] = '-';

    return s.join('').replace(/-/g, '');
};

mboxScreenHeight = function() {
    return screen.height;
};

mboxScreenWidth = function() {
    return screen.width;
};

mboxBrowserWidth = function() {
    return (window.innerWidth) ? window.innerWidth : document.documentElement ? document.documentElement.clientWidth : document.body.clientWidth;
};

mboxBrowserHeight = function() {
    return (window.innerHeight) ? window.innerHeight : document.documentElement ? document.documentElement.clientHeight : document.body.clientHeight;
};

mboxBrowserTimeOffset = function() {
    return -new Date().getTimezoneOffset();
};

mboxScreenColorDepth = function() {
    return screen.pixelDepth;
};


mbox = function(qb, ad, Mc, be, ce, Uc) {
    this.de = null;
    this.ee = 0;
    this.fe = be;
    this.ce = ce;
    this.ge = null;

    this.he = new mboxOfferContent();
    this.fd = null;
    this.Mc = Mc;


    this.message = '';
    this.ie = {};
    this.je = 0;
    this.ke = 5;

    this.ad = ad;
    this.qb = qb;

    this.le();

    Mc.addParameter(TNT.a.c.x, qb);
    Mc.addParameter(TNT.a.c.y, ad);

    this.me = function() {};
    this.gd = function() {};

    this.ne = null;

    this.oe = document.documentMode >= 10 && !Uc.isDomLoaded();

    if (this.oe) {
        this.pe = TNT.a.nestedMboxes;
        this.pe.push(this.qb);
    }
};

mbox.prototype.getId = function() {
    return this.ad;
};

mbox.prototype.le = function() {
    var maxLength = TNT.a.M.T;

    if (this.qb.length > maxLength) {
        throw "Mbox Name " + this.qb + " exceeds max length of " + maxLength + " characters.";
    } else if (this.qb.match(/^\s+|\s+$/g)) {
        throw "Mbox Name " + this.qb + " has leading/trailing whitespace(s).";
    }
};

mbox.prototype.getName = function() {
    return this.qb;
};


mbox.prototype.getParameters = function() {
    var nb = this.Mc.getParameters();
    var fc = [];

    for (var rb = 0; rb < nb.length; rb++) {

        if (nb[rb].name.indexOf('mbox') !== 0) {
            fc[fc.length] = nb[rb].name + '=' + nb[rb].value;
        }
    }

    return fc;
};


mbox.prototype.setOnLoad = function(xb) {
    this.gd = xb;
    return this;
};

mbox.prototype.setMessage = function(qe) {
    this.message = qe;
    return this;
};


mbox.prototype.setOnError = function(me) {
    this.me = me;
    return this;
};

mbox.prototype.setFetcher = function(re) {
    if (this.ge) {
        this.ge.cancel();
    }
    this.ge = re;
    return this;
};

mbox.prototype.getFetcher = function() {
    return this.ge;
};

function se(Mc, Tc) {
    var te = TNT.a,
        b = te.b,
        ue = b.mboxTimeout;

    if (te.yc() && te.zc()) {
        Mc.addParameters(te.Ic());
    }

    Tc.ge.fetch(Mc);

    Tc.ve = setTimeout(function() {
        Tc.me('browser timeout', Tc.ge.getType());
    }, ue);
}

function we(Tc) {
    var ne = Tc.getDefaultDiv();

    if (ne) {
        Tc.xe(Tc.getDefaultDiv());
    }
}

function ye(Mc, Tc, Cc) {
    var te = TNT.a;

    Tc.setFetcher(new mboxAjaxFetcher());

    te.Dc(Cc, function(ze) {
        if (ze === null) {
            se(Mc, Tc);
            return;
        }

        if (Cc && ze.optout) {
            we(Tc);
            return;
        }

        Mc.addParameters(ze.params);
        se(Mc, Tc);
    });
}


mbox.prototype.load = function(nb) {
    var vd = this,
        Mc = vd.Mc,
        te = TNT.a,
        b = te.b,
        Cc = b.optoutEnabled;

    if (vd.ge === null) {
        return vd;
    }

    vd.cancelTimeout();
    vd.ee = 0;

    if (nb && nb.length > 0) {
        Mc = vd.Mc.clone().addParameters(nb);
    }

    if (Cc && te.yc()) {
        ye(Mc, vd, Cc);
        return vd;
    }

    var yc = te.yc();

    if (yc && !te.zc()) {
        ye(Mc, vd, false);
        return vd;
    }

    se(Mc, vd);
    return vd;
};


mbox.prototype.loaded = function() {
    this.cancelTimeout();


    if (!this.activate() && this.je < this.ke) {
        var vd = this;

        setTimeout(function() {
            vd.loaded();
        }, TNT.a.b.mboxLoadedTimeout);
    }
};


mbox.prototype.activate = function() {
    if (this.ee) {
        return this.ee;
    }

    if (this.oe && this.pe[this.pe.length - 1] !== this.qb) {
        return this.ee;
    }

    if (this.show()) {
        this.cancelTimeout();
        this.ee = 1;
    }

    if (this.oe) {
        this.pe.pop();
    }

    return this.ee;
};


mbox.prototype.isActivated = function() {
    return this.ee;
};


mbox.prototype.setOffer = function(he) {
    var Ae = he && he.show && he.setOnLoad;

    if (!Ae) {
        throw 'Invalid offer';
    }

    var Be = TNT.a.b.globalMboxName === this.qb;
    Be = Be && he instanceof mboxOfferDefault;
    Be = Be && this.ge !== null;
    Be = Be && this.ge.getType() === 'ajax';

    if (!Be) {
        this.he = he;

        return this;
    }





    var Ce = this.he.gd;
    this.he = he;

    this.he.setOnLoad(Ce);

    return this;
};

mbox.prototype.getOffer = function() {
    return this.he;
};


mbox.prototype.show = function() {
    return this.he.show(this);
};


mbox.prototype.showContent = function(hd) {
    if (!mbox.De(hd)) {
        return 0;
    }

    this.fd = mbox.Ee(this, this.fd);

    if (this.fd === null) {
        return 0;
    }

    if (!mbox.Fe(document.body, this.fd)) {
        return 0;
    }

    if (this.fd === hd) {
        this.xe(this.fd);
        this.gd();
        return 1;
    }

    this.Ge(this.fd);
    this.Ge(hd);

    mbox.He(this, hd);

    this.xe(this.fd);
    this.gd();

    return 1;
};

mbox.De = function(hd) {
    return hd !== undefined && hd !== null;
};

mbox.Fe = function(Ie, Je) {
    var DOCUMENT_POSITION_CONTAINED_BY = 16;
    var Ke = Ie.contains !== undefined;



    if (Ke) {
        return Ie !== Je && Ie.contains(Je);
    } else {

        return Boolean(Ie.compareDocumentPosition(Je) & DOCUMENT_POSITION_CONTAINED_BY);
    }
};

mbox.Ee = function(Tc, fd) {
    if (fd !== undefined && fd !== null && mbox.Fe(document.body, fd)) {
        return fd;
    }

    return Tc.getDefaultDiv();
};

mbox.He = function(Tc, Le) {
    Tc.fd.parentNode.replaceChild(Le, Tc.fd);
    Tc.fd = Le;
};


mbox.prototype.hide = function() {
    return this.showContent(this.getDefaultDiv());
};


mbox.prototype.finalize = function() {
    if (!this.getDefaultDiv()) {
        this.fe.force();
    }

    if (!this.getDiv()) {
        this.fd = mbox.Ee(this, this.fd);
    }

    this.Me();
    this.setFetcher(new mboxAjaxFetcher());
    this.cancelTimeout();
    this.gd();
};

mbox.prototype.cancelTimeout = function() {
    if (this.ve) {
        clearTimeout(this.ve);
    }

    if (this.ge) {
        this.ge.cancel();
    }
};

mbox.prototype.getDiv = function() {
    return this.fd;
};


mbox.prototype.getDefaultDiv = function() {
    if (this.ne === null) {
        this.ne = this.fe.locate();
    }
    return this.ne;
};

mbox.prototype.setEventTime = function(Ne) {
    this.ie[Ne] = (new Date()).getTime();
};

mbox.prototype.getEventTimes = function() {
    return this.ie;
};

mbox.prototype.getImportName = function() {
    return this.ce;
};

mbox.prototype.getURL = function() {
    return this.Mc.buildUrl();
};

mbox.prototype.getUrlBuilder = function() {
    return this.Mc;
};

mbox.prototype.Oe = function(fd) {
    return fd.style.display != 'none';
};

mbox.prototype.xe = function(fd) {
    this.Pe(fd, true);
};

mbox.prototype.Ge = function(fd) {
    this.Pe(fd, false);
};

mbox.prototype.Pe = function(fd, Qe) {
    fd.style.visibility = Qe ? "visible" : "hidden";
    fd.style.display = Qe ? "block" : "none";
};

mbox.prototype.Me = function() {
    this.oe = false;
};

mbox.prototype.relocateDefaultDiv = function() {
    this.ne = this.fe.locate();
};



function Re(Uc) {
    Uc.getMboxes().each(function(Tc) {
        Tc.finalize();
    });
}

mboxFactory = function(Ab, mb, Se) {
    var te = TNT.a;
    var b = te.b;
    var W = te.W;
    var H = te.H;
    var C = te.C;
    var M = te.M;
    var Te = b.mboxVersion;

    this.Ue = false;
    this.Se = Se;
    this.Sc = new mboxList();

    mboxFactories.put(Se, this);



    this.Ve = b.mboxIsSupportedFunction() && typeof(window.attachEvent || document.addEventListener || window.addEventListener) != 'undefined';

    this.We = this.Ve && mboxGetPageParameter(C.D, true) === null;

    var Xe = Se == M.N;
    var Id = M.O + (Xe ? '' : ('-' + Se));
    this.Kd = new mboxCookieManager(Id, b.cookieDomainFunction());

    if (!b.crossDomainXOnly) {
        this.We = this.We && this.Kd.isEnabled();
    }

    this.We = this.We && W.ab(this.Kd.getCookie(H.D)) && W.ab(this.Kd.getCookie(H.K));

    if (this.isAdmin()) {
        this.enable();
    }

    this.Ye();
    this.Ze = mboxGenerateId();
    this._e = mboxScreenHeight();
    this.af = mboxScreenWidth();
    this.bf = mboxBrowserWidth();
    this.cf = mboxBrowserHeight();
    this.df = mboxScreenColorDepth();
    this.ef = mboxBrowserTimeOffset();
    this.ff = new mboxSession(this.Ze, C.E, H.E,
    b.sessionExpirationTimeout, this.Kd);

    var Vd = new mboxPC(H.m, b.tntIdLifetime, this.Kd);

    this.gf = b.overrideMboxEdgeServer ? new te.Ud(Vd, this.Kd) : Vd;
    this.Mc = new mboxUrlBuilder(Ab, mb);

    this.hf(this.Mc, Xe, Te);

    this.jf = new Date().getTime();
    this.kf = this.jf;

    var vd = this;
    this.addOnLoad(function() {
        vd.kf = new Date().getTime();
    });

    if (this.Ve) {


        this.addOnLoad(function() {
            vd.Ue = true;

            Re(vd);

            TNT.a.nestedMboxes = [];
        });

        if (this.We) {
            this.limitTraffic(b.trafficLevelPercentage, b.trafficDuration);
            this.lf();
            this.mf = new mboxSignaler(this);
        } else {
            if (!b.isProduction) {
                if (this.isAdmin()) {
                    if (!this.isEnabled()) {
                        alert("mbox disabled, probably due to timeout\n" +
                            "Reset your cookies to re-enable\n(this message will only appear in administrative mode)");
                    } else {
                        alert("It looks like your browser will not allow " + b.companyName +
                            " to set its administrative cookie. To allow setting the" +
                            " cookie please lower the privacy settings of your browser.\n" +
                            "(this message will only appear in administrative mode)");
                    }
                }
            }
        }
    }
};


mboxFactory.prototype.forcePCId = function(Md) {
    if (!TNT.a.b.clientTntIdSupport) {
        return;
    }

    if (this.gf.forceId(Md)) {
        this.ff.forceId(mboxGenerateId());
    }
};


mboxFactory.prototype.forceSessionId = function(Md) {
    if (!TNT.a.b.clientSessionIdSupport) {
        return;
    }

    this.ff.forceId(Md);
};


mboxFactory.prototype.isEnabled = function() {
    return this.We;
};


mboxFactory.prototype.getDisableReason = function() {
    return this.Kd.getCookie(TNT.a.H.D);
};


mboxFactory.prototype.isSupported = function() {
    return this.Ve;
};


mboxFactory.prototype.disable = function(pd, nf) {
    if (typeof pd == 'undefined') {
        pd = 60 * 60;
    }

    if (typeof nf == 'undefined') {
        nf = 'unspecified';
    }

    if (!this.isAdmin()) {
        this.We = false;
        this.Kd.setCookie(TNT.a.H.D, nf, pd);
    }
};

mboxFactory.prototype.enable = function() {
    this.We = true;
    this.Kd.deleteCookie(TNT.a.H.D);
};

mboxFactory.prototype.isAdmin = function() {
    return document.location.href.indexOf(TNT.a.C.F) != -1;
};


mboxFactory.prototype.limitTraffic = function(of, pd) {
    if (TNT.a.b.trafficLevelPercentage != 100) {
        if (of == 100) {
            return;
        }

        var pf = true;

        if (parseInt(this.Kd.getCookie(TNT.a.H.I)) != of) {
            pf = (Math.random() * 100) <= of;
        }

        this.Kd.setCookie(TNT.a.H.I, of, pd);

        if (!pf) {
            this.disable(60 * 60, 'limited by traffic');
        }
    }
};


mboxFactory.prototype.addOnLoad = function(qf) {






    if (this.isDomLoaded()) {
        qf();
    } else {
        var rf = false;
        var sf = function() {
            if (rf) {
                return;
            }
            rf = true;
            qf();
        };

        this.tf.push(sf);

        if (this.isDomLoaded() && !rf) {
            sf();
        }
    }
};

mboxFactory.prototype.getEllapsedTime = function() {
    return this.kf - this.jf;
};

mboxFactory.prototype.getEllapsedTimeUntil = function(A) {
    return A - this.jf;
};


mboxFactory.prototype.getMboxes = function() {
    return this.Sc;
};


mboxFactory.prototype.get = function(x, y) {
    return this.Sc.get(x).getById(y || 0);
};


mboxFactory.prototype.update = function(x, nb) {
    var te = TNT.a,
        c = te.c;

    if (!this.isEnabled()) {
        return;
    }

    var vd = this;

    if (!this.isDomLoaded()) {
        this.addOnLoad(function() {
            vd.update(x, nb);
        });

        return;
    }

    if (this.Sc.get(x).length() === 0) {
        throw "Mbox " + x + " is not defined";
    }

    this.Sc.get(x).each(function(Tc) {
        var Mc = Tc.getUrlBuilder();

        Mc.addParameter(c.d, mboxGenerateId());

        vd.uf(Mc, x);

        Tc.load(nb);
    });
};


mboxFactory.prototype.setVisitorIdParameters = function(Mc, x) {
    this.uf(Mc, x);
};


mboxFactory.prototype.create = function(x, nb, vf) {
    return this.wf(x, nb, vf);
};


mboxFactory.prototype.xf = function(x, nb, vf) {
    return this.wf(x, nb, vf);
};

mboxFactory.prototype.wf = function(x, nb, vf) {
    if (!this.isSupported()) {
        return null;
    }

    var yf = new Date();
    var A = yf.getTime() - (yf.getTimezoneOffset() * TNT.a.M.Q);
    var Mc = this.Mc.clone();

    Mc.addParameter(TNT.a.c.j, this.Sc.length() + 1);
    Mc.addParameter(TNT.a.c.A, A);
    Mc.addParameters(nb);

    this.uf(Mc, x);

    var y, fe, Tc;

    if (vf) {
        fe = new mboxLocatorNode(vf);
    } else {
        if (this.Ue) {
            throw 'The page has already been loaded, can\'t write marker';
        }

        fe = new mboxLocatorDefault(this._c(x));
    }

    try {
        y = this.Sc.get(x).length();
        Tc = new mbox(x, y, Mc, fe, this.zf(x), this);

        if (this.We) {
            Tc.setFetcher(this.Ue ? new mboxAjaxFetcher() : new mboxStandardFetcher());
        }

        var vd = this;

        Tc.setOnError(function(qe, vb) {
            Tc.setMessage(qe);
            Tc.activate();

            if (!Tc.isActivated()) {
                vd.disable(TNT.a.b.mboxFactoryDisabledTimeout, qe);
                window.location.reload(false);
            }
        });

        this.Sc.add(Tc);
    } catch (Af) {
        this.disable();
        throw 'Failed creating mbox "' + x + '", the error was: ' + Af;
    }

    return Tc;
};

mboxFactory.prototype.Bf = function(Mc) {
    var m = this.gf.getId();

    if (m) {
        Mc.addParameter(TNT.a.c.m, m);
    }
};

mboxFactory.prototype.Cf = function(Mc, x) {
    var Df = !TNT.isAutoCreateGlobalMbox() && TNT.getGlobalMboxName() === x;

    if (Df) {
        Mc.addParameters(TNT.getTargetPageParameters());
    }
};

mboxFactory.prototype.Ef = function(Mc, x) {
    var te = TNT.a,
        Ff = te.c.i,
        i = te.Jc(x);



    if (i) {
        Mc.addParameter(Ff, i);
    }
};

mboxFactory.prototype.Gf = function(Mc) {
    var te = TNT.a;

    if (te.yc() && te.zc()) {
        Mc.addParameters(te.Ic());
    }
};

mboxFactory.prototype.uf = function(Mc, x) {
    this.Bf(Mc);
    this.Cf(Mc, x);
    this.Ef(Mc, x);
    this.Gf(Mc, x);
};

mboxFactory.prototype.getCookieManager = function() {
    return this.Kd;
};

mboxFactory.prototype.getPageId = function() {
    return this.Ze;
};

mboxFactory.prototype.getPCId = function() {
    return this.gf;
};

mboxFactory.prototype.getSessionId = function() {
    return this.ff;
};

mboxFactory.prototype.getSignaler = function() {
    return this.mf;
};

mboxFactory.prototype.getUrlBuilder = function() {
    return this.Mc;
};

mboxFactory.prototype.Hf = function(x) {
    return this.Se + '-' + x + '-' + this.Sc.get(x).length();
};

mboxFactory.prototype._c = function(x) {
    return TNT.a.M.S + this.Hf(x);
};

mboxFactory.prototype.zf = function(x) {
    return TNT.a.M.P + this.Hf(x);
};

mboxFactory.prototype.hf = function(Mc, Xe, Te) {

    /** START = Custom code to add MDL values as mbox PARAMS  = **/
    iterateParams = function(paramObj, paramType) {
        if (typeof paramObj !== 'undefined' && paramObj !== "") {
            for (var index in paramObj) {
                if (paramObj.hasOwnProperty(index)) {
                    var paramValue = paramObj[index];
                    if (typeof paramValue !== 'undefined' && paramValue !== 'undefined' && paramValue !== '' && paramValue !== null && paramValue.length > 0) {
                        if (paramType == "profile") {
                            paramValue = "profile." + paramValue;
                        } else if (paramType == "entity") {
                            paramValue = "entity." + paramValue;
                        }
                        Mc.addParameter(index, paramValue);
                    }
                }
            }
        }
    };
    iterateParams(targetPParams(), "");
    // iterateParams(targetPProfileParams(), "profile");
    /** END = Custom code to add MDL values as mbox PARAMS  = **/

    Mc.addParameter(TNT.a.c.k, document.location.hostname);
    Mc.addParameter(TNT.a.c.d, this.Ze);
    Mc.addParameter(TNT.a.c.n, this._e);
    Mc.addParameter(TNT.a.c.o, this.af);
    Mc.addParameter(TNT.a.c.p, this.bf);
    Mc.addParameter(TNT.a.c.q, this.cf);
    Mc.addParameter(TNT.a.c.r, this.ef);
    Mc.addParameter(TNT.a.c.s, this.df);
    Mc.addParameter(TNT.a.C.E, this.ff.getId());

    if (!Xe) {
        Mc.addParameter(TNT.a.c.l, this.Se);
    }

    if (TNT.a.b.crossDomainEnabled) {
        Mc.addParameter(TNT.a.c.t, TNT.a.b.crossDomain);
    }

    var c = TNT.getClientMboxExtraParameters();

    if (c) {
        Mc.addParameters(c.split('&'));
    }

    Mc.setUrlProcessAction(function(u) {
        if (TNT.a.b.passPageParameters) {
            u += '&';
            u += TNT.a.c.u;
            u += '=' + encodeURIComponent(document.location);

            var v = encodeURIComponent(document.referrer);

            if (u.length + v.length < 2000) {
                u += '&';
                u += TNT.a.c.v;
                u += '=' + v;
            }
        }

        u += '&';
        u += TNT.a.c.w;
        u += '=' + Te;

        return u;
    });
};


mboxFactory.prototype.lf = function() {
    document.write('<style>.' + TNT.a.M.R + ' { visibility:hidden; }</style>');
};

mboxFactory.prototype.isDomLoaded = function() {
    return this.Ue;
};

mboxFactory.prototype.Ye = function() {
    if (this.tf) {
        return;
    }

    this.tf = [];

    var vd = this;
    (function() {
        var If = document.addEventListener ? "DOMContentLoaded" : "onreadystatechange";
        var Jf = false;
        var Kf = function() {
            if (Jf) {
                return;
            }
            Jf = true;
            for (var i = 0; i < vd.tf.length; ++i) {
                vd.tf[i]();
            }
        };

        if (document.addEventListener) {
            document.addEventListener(If, function() {
                document.removeEventListener(If, arguments.callee, false);
                Kf();
            }, false);

            window.addEventListener("load", function() {
                document.removeEventListener("load", arguments.callee, false);
                Kf();
            }, false);

        } else if (document.attachEvent) {
            if (self !== self.top) {
                document.attachEvent(If, function() {
                    if (document.readyState === 'complete') {
                        document.detachEvent(If, arguments.callee);
                        Kf();
                    }
                });
            } else {
                var Lf = function() {
                    try {
                        document.documentElement.doScroll('left');
                        Kf();
                    } catch (Mf) {
                        setTimeout(Lf, 13);
                    }
                };
                Lf();
            }
        }

        if (document.readyState === "complete") {
            Kf();
        }

    })();
};

(function(X) {
    function Nf(Of, Id, pd, Kd) {
        if (Of.targetJSLoaded) {
            return;
        }

        Kd.setCookie(Id, true, pd);
        window.location.reload();
    }

    function Pf(b, H, Kd) {
        var Qf = '_AT',
            Sf = 50,
            Id = H.K,
            pd = b.experienceManagerDisabledTimeout,
            de = b.experienceManagerTimeout,
            u = b.experienceManagerPluginUrl,

            Tf = function(Uf) {},

            Vf = function(Uf) {
                setTimeout(function() {
                    window[Qf].applyWhenReady(Uf);
                }, Sf);
            };

        if (Qf in window) {
            return;
        }

        window[Qf] = {};

        if (Kd.getCookie(Id) !== 'true') {
            document.write('<scr' + 'ipt src="' + u + '"><\/sc' + 'ript>');

            window[Qf].applyWhenReady = Vf;

            setTimeout(function() {
                Nf(window[Qf], Id, pd, Kd);
            }, de);
        } else {
            window[Qf].applyWhenReady = Tf;
        }
    }

    X.Pf = Pf;
}(TNT.a));

(function(X, a, W, b, c, M) {
    function Wf() {
        return b.globalMboxName;
    }

    function Xf() {
        return b.globalMboxLocationDomId;
    }

    function Yf() {
        return b.globalMboxAutoCreate;
    }

    function Zf() {
        return b.parametersFunction();
    }

    function _f() {
        var cd = 1,
            ag = document.getElementsByTagName('script'),
            dd = ag[ag.length - 1];

        while (dd) {
            if (dd.nodeType === cd && dd.className === M.R) {
                return dd;
            }

            dd = dd.previousSibling;
        }

        return null;
    }

    function bg(Uc, x, c) {
        var vf,
        Tc;

        if (a.yc()) {
            vf = _f();
            Tc = Uc.create(x, c, vf);
        } else {
            Tc = Uc.create(x, c);
        }

        if (Tc && Uc.isEnabled()) {
            Tc.load();
        }

        return Tc;
    }

    function cg(Uc, vf, x, c) {
        return Uc.xf(x, c, vf);
    }

    function dg(Uc, x, c) {
        Uc.update(x, c);
    }

    function eg(Kd, qb) {
        return Kd.getCookie(qb);
    }

    function fg(Kd, qb, _, pd) {
        Kd.setCookie(qb, _, pd);
    }

    function gg(hg) {
        var fc = [];
        var ig = /([^&=]+)=([^&]*)/g;
        var jg = decodeURIComponent;
        var Rd = ig.exec(hg);

        while (Rd) {
            fc.push([jg(Rd[1]), jg(Rd[2])].join('='));
            Rd = ig.exec(hg);
        }

        return fc;
    }

    function dc(kg, Qc, cc) {
        var fc = [];

        for (var Zb in kg) {
            if (!kg.hasOwnProperty(Zb)) {
                continue;
            }

            var _ = kg[Zb];

            if (W.fb(_)) {
                Qc.push(Zb);
                fc = fc.concat(dc(_, Qc, cc));
                Qc.pop();
            } else {
                if (Qc.length > 0) {
                    fc.push([cc(Qc.concat(Zb).join('.')), _].join('='));
                } else {
                    fc.push([cc(Zb), _].join('='));
                }
            }
        }

        return fc;
    }

    function lg() {
        var mg = window.targetPageParams,
            cc = function(Zb) {
                return Zb
            };


        if (!W.cb(mg)) {
            return [];
        }

        var fc = null;

        try {
            fc = mg();
        } catch (ng) {}

        if (W.ab(fc)) {
            return [];
        }

        if (W.db(fc)) {
            return fc;
        }

        if (W.eb(fc) && !W.bb(fc)) {
            return gg(fc);
        }

        if (W.fb(fc)) {
            return dc(fc, [], cc);
        }

        return [];
    }

    function og(Uc) {
        var pg = Wf(),
            qg = Xf(),
            rg = lg(),
            sg,
            tg,
            ug;

        if (!qg) {
            qg = "mbox-" + pg + "-" + mboxGenerateId();
            sg = document.createElement("div");
            sg.className = "mboxDefault";
            sg.id = qg;
            sg.style.visibility = "hidden";
            sg.style.display = "none";

            tg = setInterval(function() {
                if (document.body) {
                    clearInterval(tg);
                    document.body.insertBefore(sg, document.body.firstChild);
                }
            }, b.bodyPollingTimeout);
        }

        ug = Uc.create(pg, rg, qg);

        if (ug && Uc.isEnabled()) {
            if (!Uc.isDomLoaded()) {
                if (!a.yc()) {
                    ug.setFetcher(new a.Oc());
                } else if (a.zc()) {
                    ug.setFetcher(new a.Oc());
                } else {
                    ug.setFetcher(new mboxAjaxFetcher());
                }
            }

            ug.load();
        }
    }

    function vg(Uc, x, nb) {
        if (!Uc.isEnabled()) {
            return;
        }

        var yf = new Date(),
            wg = yf.getTimezoneOffset() * M.Q,
            Mc = Uc.getUrlBuilder().clone();

        Mc.setBasePath('/m2/' + b.clientCode + '/viztarget');
        Mc.addParameter(c.x, x);
        Mc.addParameter(c.y, 0);
        Mc.addParameter(c.j, Uc.getMboxes().length() + 1);
        Mc.addParameter(c.A, yf.getTime() - wg);
        Mc.addParameter(c.d, mboxGenerateId());
        Mc.addParameter(c.z, Uc.isDomLoaded());

        if (nb && nb.length > 0) {
            Mc.addParameters(nb);
        }

        Uc.Bf(Mc);
        Uc.xg(Mc, x);
        Uc.Ef(Mc, x);

        return Mc.buildUrl();
    }

    function yg() {
        return new mboxMap();
    }

    function zg(Ag, mb, Se) {
        return new mboxFactory(Ag, mb, Se);
    }


    a.bg = bg;
    a.cg = cg;
    a.dg = dg;
    a.vg = vg;
    a.eg = eg;
    a.fg = fg;
    a.og = og;
    a.yg = yg;
    a.zg = zg;
    a.dc = dc;


    X.getGlobalMboxName = Wf;
    X.getGlobalMboxLocation = Xf;
    X.isAutoCreateGlobalMbox = Yf;
    X.getClientMboxExtraParameters = Zf;
    X.getTargetPageParameters = lg;
}(TNT, TNT.a, TNT.a.W, TNT.a.b, TNT.a.c, TNT.a.M));

(function(X) {
    function Bg(Kd, b, Cg, Dg) {
        var Eg = 60 * 60,
            Fg = mboxGetPageParameter(Cg, true) || Kd.getCookie(Dg);

        if (!Fg) {
            return;
        }

        setTimeout(function() {
            if (typeof(window.mboxDebugLoaded) === 'undefined') {
                alert('Could not load the remote debug.\nPlease check your connection to ' + b.companyName + ' servers');
            }
        }, Eg);

        var Db = [];

        Db.push(b.adminUrl, '/mbox/mbox_debug.jsp', '?');
        Db.push('mboxServerHost', '=', b.serverHost, '&');
        Db.push('clientCode', '=', b.clientCode);

        document.write('<' + 'scr' + 'ipt src="' + Db.join('') + '"><' + '\/scr' + 'ipt>');
    }

    function Gg(b, Hg) {
        var W = X.W,
            Ig,
            Jg,
            _;

        if (W.Z(b) || W.ab(b) || !W.fb(b)) {
            return Hg;
        }

        for (var Zb in b) {
            Ig = b.hasOwnProperty(Zb) && Hg.hasOwnProperty(Zb);
            _ = b[Zb];
            Jg = !W.Z(_) && !W.ab(_);

            if (Ig && Jg) {
                Hg[Zb] = _;
            }
        }

        return Hg;
    }

    function Kg(Uc, Kd) {
        TNT.createGlobalMbox = function() {
            X.og(Uc);
        };

        window.mboxCreate = function(x) {
            var c = [].slice.call(arguments, 1);

            return X.bg(Uc, x, c);
        };

        window.mboxDefine = function(vf, x) {
            var c = [].slice.call(arguments, 2);

            return X.cg(Uc, vf, x, c);
        };

        window.mboxUpdate = function(x) {
            var c = [].slice.call(arguments, 1);

            X.dg(Uc, x, c);
        };

        window.mboxVizTargetUrl = function(x) {
            var c = [].slice.call(arguments, 1);

            return X.vg(Uc, x, c);
        };

        window.mboxSetCookie = function(qb, _, pd) {
            return X.fg(Kd, qb, _, pd);
        };

        window.mboxGetCookie = function(qb) {
            return X.eg(Kd, qb);
        };



        if (typeof(X.Lg) !== 'undefined') {
            window.mboxLoadSCPlugin = function(Mg) {
                return X.Lg(Uc, Mg);
            }
        }
    }

    function Ng() {
        if (typeof(window.mboxVersion) !== 'undefined') {
            return;
        }

        X.b = Gg(window.targetGlobalSettings, X.b);

        var b = X.b,
            Te = b.mboxVersion,
            Ag = b.serverHost,
            mb = b.clientCode,
            N = X.M.N,
            Cg = X.C.G,
            Dg = X.H.G,
            Og = X.H.L,
            Uc,
            Kd;


        window.mboxFactories = X.yg();
        window.mboxFactoryDefault = Uc = X.zg(Ag, mb, N);
        window.mboxVersion = Te;

        Kd = Uc.getCookieManager();

        Kg(Uc, Kd);
        Bg(Kd, b, Cg, Dg);

        X.Bb = function(Pg) {
            var lb;

            if (!b.overrideMboxEdgeServer) {
                return Pg;
            }

            lb = Kd.getCookie(Og);

            return lb === null ? Pg : lb;
        }
    }

    X.Ng = Ng;
}(TNT.a));


TNT.a.Ng();


TNT.a.Pf(TNT.a.b, TNT.a.H,
window.mboxFactoryDefault.getCookieManager());


if (TNT.isAutoCreateGlobalMbox()) {
    TNT.createGlobalMbox();
}


/*
  ======= START DIL code for Audience Manager - can function without Visitor ID =======
  */

 "function"!==typeof window.DIL&&(window.DIL=function(a,c){var b=[],d,f;a!==Object(a)&&(a={});var g,k,r,v,s,p,n,E,u,A,L,B,C,F;g=a.partner;k=a.containerNSID;r=!!a.disableDestinationPublishingIframe;v=a.iframeAkamaiHTTPS;s=a.mappings;p=a.uuidCookie;n=!0===a.enableErrorReporting;E=a.visitorService;u=a.declaredId;A=!0===a.removeFinishedScriptsAndCallbacks;L=!0===a.delayAllUntilWindowLoad;B=!0===a.disableIDSyncs;C="undefined"===typeof a.secureDataCollection||!0===a.secureDataCollection;F=!0===a.useCORSOnly;
var M,N,I,G,O,P,Q,R;M=!0===a.disableScriptAttachment;N=!0===a.disableDefaultRequest;I=a.afterResultForDefaultRequest;G=a.dpIframeSrc;O=!0===a.testCORS;P=!0===a.useJSONPOnly;Q=a.visitorConstructor;R=!0===a.disableCORS;n&&DIL.errorModule.activate();var T=!0===window._dil_unit_tests;(d=c)&&b.push(d+"");if(!g||"string"!==typeof g)return d="DIL partner is invalid or not specified in initConfig",DIL.errorModule.handleError({name:"error",message:d,filename:"dil.js"}),Error(d);d="DIL containerNSID is invalid or not specified in initConfig, setting to default of 0";
if(k||"number"===typeof k)k=parseInt(k,10),!isNaN(k)&&0<=k&&(d="");d&&(k=0,b.push(d),d="");f=DIL.getDil(g,k);if(f instanceof DIL&&f.api.getPartner()===g&&f.api.getContainerNSID()===k)return f;if(this instanceof DIL)DIL.registerDil(this,g,k);else return new DIL(a,"DIL was not instantiated with the 'new' operator, returning a valid instance with partner = "+g+" and containerNSID = "+k);var z={IS_HTTPS:C||"https:"===document.location.protocol,POST_MESSAGE_ENABLED:!!window.postMessage,COOKIE_MAX_EXPIRATION_DATE:"Tue, 19 Jan 2038 03:14:07 UTC"},
J={stuffed:{}},m={},q={firingQueue:[],fired:[],firing:!1,sent:[],errored:[],reservedKeys:{sids:!0,pdata:!0,logdata:!0,callback:!0,postCallbackFn:!0,useImageRequest:!0},callbackPrefix:"demdexRequestCallback",firstRequestHasFired:!1,useJSONP:!0,abortRequests:!1,num_of_jsonp_responses:0,num_of_jsonp_errors:0,num_of_cors_responses:0,num_of_cors_errors:0,corsErrorSources:[],num_of_img_responses:0,num_of_img_errors:0,toRemove:[],removed:[],readyToRemove:!1,platformParams:{d_nsid:k+"",d_rtbd:"json",d_jsonv:DIL.jsonVersion+
"",d_dst:"1"},nonModStatsParams:{d_rtbd:!0,d_dst:!0,d_cts:!0,d_rs:!0},modStatsParams:null,adms:{TIME_TO_CATCH_ALL_REQUESTS_RELEASE:2E3,calledBack:!1,mid:null,noVisitorAPI:!1,VisitorAPI:null,instance:null,releaseType:"no VisitorAPI",isOptedOut:!0,isOptedOutCallbackCalled:!1,admsProcessingStarted:!1,process:function(e){try{if(!this.admsProcessingStarted){this.admsProcessingStarted=!0;var x=this,a,h,d,b;if("function"===typeof e&&"function"===typeof e.getInstance){if(E===Object(E)&&(a=E.namespace)&&"string"===
typeof a)h=e.getInstance(a,{idSyncContainerID:k});else{this.releaseType="no namespace";this.releaseRequests();return}if(h===Object(h)&&h instanceof e&&"function"===typeof h.isAllowed&&"function"===typeof h.getMarketingCloudVisitorID&&"function"===typeof h.getCustomerIDs&&"function"===typeof h.isOptedOut){this.VisitorAPI=e;if(!h.isAllowed()){this.releaseType="VisitorAPI not allowed";this.releaseRequests();return}this.instance=h;d=function(e){"VisitorAPI"!==x.releaseType&&(x.mid=e,x.releaseType="VisitorAPI",
x.releaseRequests())};b=h.getMarketingCloudVisitorID(d);if("string"===typeof b&&b.length){d(b);return}setTimeout(function(){"VisitorAPI"!==x.releaseType&&(x.releaseType="timeout",x.releaseRequests())},this.TIME_TO_CATCH_ALL_REQUESTS_RELEASE);return}this.releaseType="invalid instance"}else this.noVisitorAPI=!0;this.releaseRequests()}}catch(c){this.releaseRequests()}},releaseRequests:function(){this.calledBack=!0;q.registerRequest()},getMarketingCloudVisitorID:function(){return this.instance?this.instance.getMarketingCloudVisitorID():
null},getMIDQueryString:function(){var e=w.isPopulatedString,x=this.getMarketingCloudVisitorID();e(this.mid)&&this.mid===x||(this.mid=x);return e(this.mid)?"d_mid="+this.mid+"&":""},getCustomerIDs:function(){return this.instance?this.instance.getCustomerIDs():null},getCustomerIDsQueryString:function(e){if(e===Object(e)){var x="",a=[],h=[],d,b;for(d in e)e.hasOwnProperty(d)&&(h[0]=d,b=e[d],b===Object(b)&&(h[1]=b.id||"",h[2]=b.authState||0,a.push(h),h=[]));if(h=a.length)for(e=0;e<h;e++)x+="&d_cid_ic="+
t.encodeAndBuildRequest(a[e],"%01");return x}return""},getIsOptedOut:function(){this.instance?this.instance.isOptedOut([this,this.isOptedOutCallback],this.VisitorAPI.OptOut.GLOBAL,!0):(this.isOptedOut=!1,this.isOptedOutCallbackCalled=!0)},isOptedOutCallback:function(e){this.isOptedOut=e;this.isOptedOutCallbackCalled=!0;q.registerRequest()}},declaredId:{declaredId:{init:null,request:null},declaredIdCombos:{},setDeclaredId:function(e,a){var l=w.isPopulatedString,h=encodeURIComponent;if(e===Object(e)&&
l(a)){var d=e.dpid,b=e.dpuuid,c=null;if(l(d)&&l(b)){c=h(d)+"$"+h(b);if(!0===this.declaredIdCombos[c])return"setDeclaredId: combo exists for type '"+a+"'";this.declaredIdCombos[c]=!0;this.declaredId[a]={dpid:d,dpuuid:b};return"setDeclaredId: succeeded for type '"+a+"'"}}return"setDeclaredId: failed for type '"+a+"'"},getDeclaredIdQueryString:function(){var e=this.declaredId.request,a=this.declaredId.init,l=encodeURIComponent,h="";null!==e?h="&d_dpid="+l(e.dpid)+"&d_dpuuid="+l(e.dpuuid):null!==a&&(h=
"&d_dpid="+l(a.dpid)+"&d_dpuuid="+l(a.dpuuid));return h}},registerRequest:function(e){var a=this.firingQueue;e===Object(e)&&a.push(e);this.firing||!a.length||L&&!DIL.windowLoaded||(this.adms.isOptedOutCallbackCalled||this.adms.getIsOptedOut(),this.adms.calledBack&&!this.adms.isOptedOut&&this.adms.isOptedOutCallbackCalled&&(this.adms.isOptedOutCallbackCalled=!1,e=a.shift(),e.src=e.src.replace(/demdex.net\/event\?d_nsid=/,"demdex.net/event?"+this.adms.getMIDQueryString()+"d_nsid="),w.isPopulatedString(e.corsPostData)&&
(e.corsPostData=e.corsPostData.replace(/^d_nsid=/,this.adms.getMIDQueryString()+"d_nsid=")),D.fireRequest(e),this.firstRequestHasFired||"script"!==e.tag&&"cors"!==e.tag||(this.firstRequestHasFired=!0)))},processVisitorAPI:function(){this.adms.process(Q||window.Visitor)},requestRemoval:function(e){if(!A)return"removeFinishedScriptsAndCallbacks is not boolean true";var a=this.toRemove,l,h;e===Object(e)&&(l=e.script,h=e.callbackName,(l===Object(l)&&"SCRIPT"===l.nodeName||"no script created"===l)&&"string"===
typeof h&&h.length&&a.push(e));if(this.readyToRemove&&a.length){h=a.shift();l=h.script;h=h.callbackName;"no script created"!==l?(e=l.src,l.parentNode.removeChild(l)):e=l;window[h]=null;try{delete window[h]}catch(d){}this.removed.push({scriptSrc:e,callbackName:h});DIL.variables.scriptsRemoved.push(e);DIL.variables.callbacksRemoved.push(h);return this.requestRemoval()}return"requestRemoval() processed"}};f=function(){var e="http://fast.",a="?d_nsid="+k+"#"+encodeURIComponent(document.location.href);
if("string"===typeof G&&G.length)return G+a;z.IS_HTTPS&&(e=!0===v?"https://fast.":"https://");return e+g+".demdex.net/dest5.html"+a};var y={THROTTLE_START:3E4,throttleTimerSet:!1,id:"destination_publishing_iframe_"+g+"_"+k,url:f(),iframe:null,iframeHasLoaded:!1,sendingMessages:!1,messages:[],messagesPosted:[],messageSendingInterval:z.POST_MESSAGE_ENABLED?15:100,ibsDeleted:[],jsonProcessed:[],newIframeCreated:null,iframeIdChanged:!1,originalIframeHasLoadedAlready:null,attachIframe:function(){function e(){h=
document.createElement("iframe");h.sandbox="allow-scripts allow-same-origin";h.title="Adobe ID Syncing iFrame";h.id=l.id;h.style.cssText="display: none; width: 0; height: 0;";h.src=l.url;l.newIframeCreated=!0;a();document.body.appendChild(h)}function a(){t.addListener(h,"load",function(){h.className="aamIframeLoaded";l.iframeHasLoaded=!0;l.requestToProcess()})}var l=this,h=document.getElementById(this.id);h?"IFRAME"!==h.nodeName?(this.id+="_2",this.iframeIdChanged=!0,e()):(this.newIframeCreated=!1,
"aamIframeLoaded"!==h.className?(this.originalIframeHasLoadedAlready=!1,a()):(this.iframeHasLoaded=this.originalIframeHasLoadedAlready=!0,this.iframe=h,this.requestToProcess())):e();this.iframe=h},requestToProcess:function(e,a){var l=this;e&&!w.isEmptyObject(e)&&this.process(e,a);this.iframeHasLoaded&&this.messages.length&&!this.sendingMessages&&(this.throttleTimerSet||(this.throttleTimerSet=!0,setTimeout(function(){l.messageSendingInterval=z.POST_MESSAGE_ENABLED?15:150},this.THROTTLE_START)),this.sendingMessages=
!0,this.sendMessages())},process:function(e,a){var l=encodeURIComponent,h,d,b,c,g,f;a===Object(a)&&(f=t.encodeAndBuildRequest(["",a.dpid||"",a.dpuuid||""],","));if((h=e.dests)&&h instanceof Array&&(d=h.length))for(b=0;b<d;b++)c=h[b],c=[l("dests"),l(c.id||""),l(c.y||""),l(c.c||"")],this.addMessage(c.join("|"));if((h=e.ibs)&&h instanceof Array&&(d=h.length))for(b=0;b<d;b++)c=h[b],c=[l("ibs"),l(c.id||""),l(c.tag||""),t.encodeAndBuildRequest(c.url||[],","),l(c.ttl||""),"",f],this.addMessage(c.join("|"));
if((h=e.dpcalls)&&h instanceof Array&&(d=h.length))for(b=0;b<d;b++)c=h[b],g=c.callback||{},g=[g.obj||"",g.fn||"",g.key||"",g.tag||"",g.url||""],c=[l("dpm"),l(c.id||""),l(c.tag||""),t.encodeAndBuildRequest(c.url||[],","),l(c.ttl||""),t.encodeAndBuildRequest(g,","),f],this.addMessage(c.join("|"));this.jsonProcessed.push(e)},addMessage:function(e){var a=encodeURIComponent,a=n?a("---destpub-debug---"):a("---destpub---");this.messages.push(a+e)},sendMessages:function(){var e=this,a;this.messages.length?
(a=this.messages.shift(),DIL.xd.postMessage(a,this.url,this.iframe.contentWindow),this.messagesPosted.push(a),setTimeout(function(){e.sendMessages()},this.messageSendingInterval)):this.sendingMessages=!1}},K={traits:function(e){w.isValidPdata(e)&&(m.sids instanceof Array||(m.sids=[]),t.extendArray(m.sids,e));return this},pixels:function(e){w.isValidPdata(e)&&(m.pdata instanceof Array||(m.pdata=[]),t.extendArray(m.pdata,e));return this},logs:function(e){w.isValidLogdata(e)&&(m.logdata!==Object(m.logdata)&&
(m.logdata={}),t.extendObject(m.logdata,e));return this},customQueryParams:function(e){w.isEmptyObject(e)||t.extendObject(m,e,q.reservedKeys);return this},signals:function(e,a){var l,h=e;if(!w.isEmptyObject(h)){if(a&&"string"===typeof a)for(l in h={},e)e.hasOwnProperty(l)&&(h[a+l]=e[l]);t.extendObject(m,h,q.reservedKeys)}return this},declaredId:function(e){q.declaredId.setDeclaredId(e,"request");return this},result:function(e){"function"===typeof e&&(m.callback=e);return this},afterResult:function(e){"function"===
typeof e&&(m.postCallbackFn=e);return this},useImageRequest:function(){m.useImageRequest=!0;return this},clearData:function(){m={};return this},submit:function(){D.submitRequest(m);m={};return this},getPartner:function(){return g},getContainerNSID:function(){return k},getEventLog:function(){return b},getState:function(){var e={},b={};t.extendObject(e,q,{callbackPrefix:!0,useJSONP:!0,registerRequest:!0});t.extendObject(b,y,{attachIframe:!0,requestToProcess:!0,process:!0,sendMessages:!0});return{initConfig:a,
pendingRequest:m,otherRequestInfo:e,destinationPublishingInfo:b}},idSync:function(e){if(B)return"Error: id syncs have been disabled";if(e!==Object(e)||"string"!==typeof e.dpid||!e.dpid.length)return"Error: config or config.dpid is empty";if("string"!==typeof e.url||!e.url.length)return"Error: config.url is empty";var a=e.url,b=e.minutesToLive,h=encodeURIComponent,d,a=a.replace(/^https:/,"").replace(/^http:/,"");if("undefined"===typeof b)b=20160;else if(b=parseInt(b,10),isNaN(b)||0>=b)return"Error: config.minutesToLive needs to be a positive number";
d=t.encodeAndBuildRequest(["",e.dpid,e.dpuuid||""],",");e=["ibs",h(e.dpid),"img",h(a),b,"",d];y.addMessage(e.join("|"));q.firstRequestHasFired&&y.requestToProcess();return"Successfully queued"},aamIdSync:function(e){if(B)return"Error: id syncs have been disabled";if(e!==Object(e)||"string"!==typeof e.dpuuid||!e.dpuuid.length)return"Error: config or config.dpuuid is empty";e.url="//dpm.demdex.net/ibs:dpid="+e.dpid+"&dpuuid="+e.dpuuid;return this.idSync(e)},passData:function(e){if(w.isEmptyObject(e))return"Error: json is empty or not an object";
y.ibsDeleted.push(e.ibs);delete e.ibs;D.defaultCallback(e);return e},getPlatformParams:function(){return q.platformParams},getEventCallConfigParams:function(){var e=q,a=e.modStatsParams,b=e.platformParams,h;if(!a){a={};for(h in b)b.hasOwnProperty(h)&&!e.nonModStatsParams[h]&&(a[h.replace(/^d_/,"")]=b[h]);e.modStatsParams=a}return a}},D={corsMetadata:function(){var e="none",a=!0;"undefined"!==typeof XMLHttpRequest&&XMLHttpRequest===Object(XMLHttpRequest)&&("withCredentials"in new XMLHttpRequest?e=
"XMLHttpRequest":(new Function("/*@cc_on return /^10/.test(@_jscript_version) @*/"))()?e="XMLHttpRequest":"undefined"!==typeof XDomainRequest&&XDomainRequest===Object(XDomainRequest)&&(a=!1),0<Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")&&(a=!1));return{corsType:e,corsCookiesEnabled:a}}(),getCORSInstance:function(){return"none"===this.corsMetadata.corsType?null:new window[this.corsMetadata.corsType]},submitRequest:function(e){q.registerRequest(D.createQueuedRequest(e));
return!0},createQueuedRequest:function(e){var a=q,b,h=e.callback,d="img",c;if(!w.isEmptyObject(s)){var g,f,p;for(g in s)s.hasOwnProperty(g)&&(f=s[g],null!=f&&""!==f&&g in e&&!(f in e||f in q.reservedKeys)&&(p=e[g],null!=p&&""!==p&&(e[f]=p)))}w.isValidPdata(e.sids)||(e.sids=[]);w.isValidPdata(e.pdata)||(e.pdata=[]);w.isValidLogdata(e.logdata)||(e.logdata={});e.logdataArray=t.convertObjectToKeyValuePairs(e.logdata,"=",!0);e.logdataArray.push("_ts="+(new Date).getTime());"function"!==typeof h&&(h=this.defaultCallback);
a.useJSONP=!0!==e.useImageRequest;a.useJSONP&&(d="script",b=a.callbackPrefix+"_"+k+"_"+(new Date).getTime());a=this.makeRequestSrcData(e,b);P&&!F||!(c=this.getCORSInstance())||(d="cors");return{tag:d,src:a.src,corsSrc:a.corsSrc,internalCallbackName:b,callbackFn:h,postCallbackFn:e.postCallbackFn,useImageRequest:!!e.useImageRequest,requestData:e,corsInstance:c,corsPostData:a.corsPostData}},defaultCallback:function(e,a){var b,h,d,c,g,f,k,u,n;if((b=e.stuff)&&b instanceof Array&&(h=b.length))for(d=0;d<
h;d++)if((c=b[d])&&c===Object(c)){g=c.cn;f=c.cv;k=c.ttl;if("undefined"===typeof k||""===k)k=Math.floor(t.getMaxCookieExpiresInMinutes()/60/24);u=c.dmn||"."+document.domain.replace(/^www\./,"");n=c.type;g&&(f||"number"===typeof f)&&("var"!==n&&(k=parseInt(k,10))&&!isNaN(k)&&t.setCookie(g,f,1440*k,"/",u,!1),J.stuffed[g]=f)}b=e.uuid;w.isPopulatedString(b)&&!w.isEmptyObject(p)&&(h=p.path,"string"===typeof h&&h.length||(h="/"),d=parseInt(p.days,10),isNaN(d)&&(d=100),t.setCookie(p.name||"aam_did",b,1440*
d,h,p.domain||"."+document.domain.replace(/^www\./,""),!0===p.secure));r||q.abortRequests||y.requestToProcess(e,a)},makeRequestSrcData:function(e,a){e.sids=w.removeEmptyArrayValues(e.sids||[]);e.pdata=w.removeEmptyArrayValues(e.pdata||[]);var b=q,h=b.platformParams,d=t.encodeAndBuildRequest(e.sids,","),c=t.encodeAndBuildRequest(e.pdata,","),f=(e.logdataArray||[]).join("&");delete e.logdataArray;var p=z.IS_HTTPS?"https://":"http://",u=b.declaredId.getDeclaredIdQueryString(),n=b.adms.instance?b.adms.getCustomerIDsQueryString(b.adms.getCustomerIDs()):
"",s;s=[];var m,r,v,A;for(m in e)if(!(m in b.reservedKeys)&&e.hasOwnProperty(m))if(r=e[m],m=encodeURIComponent(m),r instanceof Array)for(v=0,A=r.length;v<A;v++)s.push(m+"="+encodeURIComponent(r[v]));else s.push(m+"="+encodeURIComponent(r));s=s.length?"&"+s.join("&"):"";d="d_nsid="+h.d_nsid+u+n+(d.length?"&d_sid="+d:"")+(c.length?"&d_px="+c:"")+(f.length?"&d_ld="+encodeURIComponent(f):"");h="&d_rtbd="+h.d_rtbd+"&d_jsonv="+h.d_jsonv+"&d_dst="+h.d_dst;p=p+g+".demdex.net/event";c=b=p+"?"+d+(b.useJSONP?
h+"&d_cb="+(a||""):"")+s;2048<b.length&&(b=b.substring(0,2048).substring(0,b.lastIndexOf("&")));return{corsSrc:p+"?"+(O?"testcors=1&d_nsid="+k+"&":"")+"_ts="+(new Date).getTime(),src:b,originalSrc:c,corsPostData:d+h+s,isDeclaredIdCall:""!==u}},fireRequest:function(e){if("img"===e.tag)this.fireImage(e);else{var a=q.declaredId,a=a.declaredId.request||a.declaredId.init||{},a={dpid:a.dpid||"",dpuuid:a.dpuuid||""};"script"===e.tag?this.fireScript(e,a):"cors"===e.tag&&this.fireCORS(e,a)}},fireImage:function(e){var a=
q,c,h;a.abortRequests||(a.firing=!0,c=new Image(0,0),a.sent.push(e),c.onload=function(){a.firing=!1;a.fired.push(e);a.num_of_img_responses++;a.registerRequest()},h=function(c){d="imgAbortOrErrorHandler received the event of type "+c.type;b.push(d);a.abortRequests=!0;a.firing=!1;a.errored.push(e);a.num_of_img_errors++;a.registerRequest()},c.addEventListener?(c.addEventListener("error",h,!1),c.addEventListener("abort",h,!1)):c.attachEvent&&(c.attachEvent("onerror",h),c.attachEvent("onabort",h)),c.src=
e.src)},fireScript:function(a,c){var f=this,h=q,k,p,u=a.src,n=a.postCallbackFn,s="function"===typeof n,m=a.internalCallbackName;h.abortRequests||(h.firing=!0,window[m]=function(f){try{f!==Object(f)&&(f={});B&&(y.ibsDeleted.push(f.ibs),delete f.ibs);var l=a.callbackFn;h.firing=!1;h.fired.push(a);h.num_of_jsonp_responses++;l(f,c);s&&n(f,c)}catch(k){k.message="DIL jsonp callback caught error with message "+k.message;d=k.message;b.push(d);k.filename=k.filename||"dil.js";k.partner=g;DIL.errorModule.handleError(k);
try{l({error:k.name+"|"+k.message},c),s&&n({error:k.name+"|"+k.message},c)}catch(u){}}finally{h.requestRemoval({script:p,callbackName:m}),h.registerRequest()}},M||F?(h.firing=!1,h.requestRemoval({script:"no script created",callbackName:m})):(p=document.createElement("script"),p.addEventListener&&p.addEventListener("error",function(b){h.requestRemoval({script:p,callbackName:m});d="jsonp script tag error listener received the event of type "+b.type+" with src "+u;f.handleScriptError(d,a)},!1),p.type=
"text/javascript",p.src=u,k=DIL.variables.scriptNodeList[0],k.parentNode.insertBefore(p,k)),h.sent.push(a),h.declaredId.declaredId.request=null)},fireCORS:function(a,c){var f=this,h=q,k=this.corsMetadata.corsType,p=a.corsSrc,u=a.corsInstance,n=a.corsPostData,s=a.postCallbackFn,m="function"===typeof s;if(!h.abortRequests&&!R){h.firing=!0;try{u.open("post",p,!0),"XMLHttpRequest"===k&&(u.withCredentials=!0,u.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),u.onreadystatechange=function(){if(4===
this.readyState&&200===this.status)a:{var k;try{if(k=JSON.parse(this.responseText),k!==Object(k)){f.handleCORSError(a,c,"Response is not JSON");break a}}catch(p){f.handleCORSError(a,c,"Error parsing response as JSON");break a}B&&(y.ibsDeleted.push(k.ibs),delete k.ibs);try{var u=a.callbackFn;h.firing=!1;h.fired.push(a);h.num_of_cors_responses++;u(k,c);m&&s(k,c)}catch(n){n.message="DIL handleCORSResponse caught error with message "+n.message;d=n.message;b.push(d);n.filename=n.filename||"dil.js";n.partner=
g;DIL.errorModule.handleError(n);try{u({error:n.name+"|"+n.message},c),m&&s({error:n.name+"|"+n.message},c)}catch(q){}}finally{h.registerRequest()}}}),u.onerror=function(){f.handleCORSError(a,c,"onerror")},u.ontimeout=function(){f.handleCORSError(a,c,"ontimeout")},u.send(n)}catch(r){this.handleCORSError(a,c,"try-catch")}h.sent.push(a);h.declaredId.declaredId.request=null}},handleCORSError:function(a,b,c){q.num_of_cors_errors++;q.corsErrorSources.push(c);"ontimeout"===c||F||(a.tag="script",this.fireScript(a,
b))},handleScriptError:function(a,b){q.num_of_jsonp_errors++;this.handleRequestError(a,b)},handleRequestError:function(a,c){var d=q;b.push(a);d.abortRequests=!0;d.firing=!1;d.errored.push(c);d.registerRequest()}},w={isValidPdata:function(a){return a instanceof Array&&this.removeEmptyArrayValues(a).length?!0:!1},isValidLogdata:function(a){return!this.isEmptyObject(a)},isEmptyObject:function(a){if(a!==Object(a))return!0;for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},removeEmptyArrayValues:function(a){for(var b=
0,c=a.length,d,f=[],b=0;b<c;b++)d=a[b],"undefined"!==typeof d&&null!==d&&""!==d&&f.push(d);return f},isPopulatedString:function(a){return"string"===typeof a&&a.length}},t={addListener:function(){if(document.addEventListener)return function(a,b,c){a.addEventListener(b,function(a){"function"===typeof c&&c(a)},!1)};if(document.attachEvent)return function(a,b,c){a.attachEvent("on"+b,function(a){"function"===typeof c&&c(a)})}}(),convertObjectToKeyValuePairs:function(a,b,c){var d=[],f,g;b||(b="=");for(f in a)a.hasOwnProperty(f)&&
(g=a[f],"undefined"!==typeof g&&null!==g&&""!==g&&d.push(f+b+(c?encodeURIComponent(g):g)));return d},encodeAndBuildRequest:function(a,b){return this.map(a,function(a){return encodeURIComponent(a)}).join(b)},map:function(a,b){if(Array.prototype.map)return a.map(b);if(void 0===a||null===a)throw new TypeError;var c=Object(a),d=c.length>>>0;if("function"!==typeof b)throw new TypeError;for(var f=Array(d),g=0;g<d;g++)g in c&&(f[g]=b.call(b,c[g],g,c));return f},filter:function(a,b){if(!Array.prototype.filter){if(void 0===
a||null===a)throw new TypeError;var c=Object(a),d=c.length>>>0;if("function"!==typeof b)throw new TypeError;for(var f=[],g=0;g<d;g++)if(g in c){var k=c[g];b.call(b,k,g,c)&&f.push(k)}return f}return a.filter(b)},getCookie:function(a){a+="=";var b=document.cookie.split(";"),c,d,f;c=0;for(d=b.length;c<d;c++){for(f=b[c];" "===f.charAt(0);)f=f.substring(1,f.length);if(0===f.indexOf(a))return decodeURIComponent(f.substring(a.length,f.length))}return null},setCookie:function(a,b,c,d,f,g){var k=new Date;
c&&(c*=6E4);document.cookie=a+"="+encodeURIComponent(b)+(c?";expires="+(new Date(k.getTime()+c)).toUTCString():"")+(d?";path="+d:"")+(f?";domain="+f:"")+(g?";secure":"")},extendArray:function(a,b){return a instanceof Array&&b instanceof Array?(Array.prototype.push.apply(a,b),!0):!1},extendObject:function(a,b,c){var d;if(a===Object(a)&&b===Object(b)){for(d in b)!b.hasOwnProperty(d)||!w.isEmptyObject(c)&&d in c||(a[d]=b[d]);return!0}return!1},getMaxCookieExpiresInMinutes:function(){return((new Date(z.COOKIE_MAX_EXPIRATION_DATE)).getTime()-
(new Date).getTime())/1E3/60}};"error"===g&&0===k&&t.addListener(window,"load",function(){DIL.windowLoaded=!0});var S=!1,H=function(){S||(S=!0,q.registerRequest(),U(),r||q.abortRequests||y.attachIframe(),q.readyToRemove=!0,q.requestRemoval())},U=function(){r||setTimeout(function(){N||q.firstRequestHasFired||("function"===typeof I?K.afterResult(I).submit():K.submit())},DIL.constants.TIME_TO_DEFAULT_REQUEST)};C=document;"error"!==g&&(DIL.windowLoaded?H():"complete"!==C.readyState&&"loaded"!==C.readyState?
t.addListener(window,"load",function(){DIL.windowLoaded=!0;H()}):(DIL.windowLoaded=!0,H()));q.declaredId.setDeclaredId(u,"init");q.processVisitorAPI();this.api=K;this.getStuffedVariable=function(a){var b=J.stuffed[a];b||"number"===typeof b||(b=t.getCookie(a))||"number"===typeof b||(b="");return b};this.validators=w;this.helpers=t;this.constants=z;this.log=b;T&&(this.pendingRequest=m,this.requestController=q,this.setDestinationPublishingUrl=f,this.destinationPublishing=y,this.requestProcs=D,this.variables=
J,this.callWindowLoadFunctions=H)},function(){var a=document,c;null==a.readyState&&a.addEventListener&&(a.readyState="loading",a.addEventListener("DOMContentLoaded",c=function(){a.removeEventListener("DOMContentLoaded",c,!1);a.readyState="complete"},!1))}(),DIL.extendStaticPropertiesAndMethods=function(a){var c;if(a===Object(a))for(c in a)a.hasOwnProperty(c)&&(this[c]=a[c])},DIL.extendStaticPropertiesAndMethods({version:"6.5",jsonVersion:1,constants:{TIME_TO_DEFAULT_REQUEST:50},variables:{scriptNodeList:document.getElementsByTagName("script"),
scriptsRemoved:[],callbacksRemoved:[]},windowLoaded:!1,dils:{},isAddedPostWindowLoad:function(a){this.windowLoaded="function"===typeof a?!!a():"boolean"===typeof a?a:!0},create:function(a){try{return new DIL(a)}catch(c){return(new Image(0,0)).src="http://error.demdex.net/event?d_nsid=0&d_px=14137&d_ld=name%3Derror%26filename%3Ddil.js%26partner%3Dno_partner%26message%3DError%2520in%2520attempt%2520to%2520create%2520DIL%2520instance%2520with%2520DIL.create()%26_ts%3D"+(new Date).getTime(),Error("Error in attempt to create DIL instance with DIL.create()")}},
registerDil:function(a,c,b){c=c+"$"+b;c in this.dils||(this.dils[c]=a)},getDil:function(a,c){var b;"string"!==typeof a&&(a="");c||(c=0);b=a+"$"+c;return b in this.dils?this.dils[b]:Error("The DIL instance with partner = "+a+" and containerNSID = "+c+" was not found")},dexGetQSVars:function(a,c,b){c=this.getDil(c,b);return c instanceof this?c.getStuffedVariable(a):""},xd:{postMessage:function(a,c,b){var d=1;c&&(window.postMessage?b.postMessage(a,c.replace(/([^:]+:\/\/[^\/]+).*/,"$1")):c&&(b.location=
c.replace(/#.*$/,"")+"#"+ +new Date+d++ +"&"+a))}}}),DIL.errorModule=function(){var a=DIL.create({partner:"error",containerNSID:0,disableDestinationPublishingIframe:!0}),c={harvestererror:14138,destpuberror:14139,dpmerror:14140,generalerror:14137,error:14137,noerrortypedefined:15021,evalerror:15016,rangeerror:15017,referenceerror:15018,typeerror:15019,urierror:15020},b=!1;return{activate:function(){b=!0},handleError:function(d){if(!b)return"DIL error module has not been activated";d!==Object(d)&&
(d={});var f=d.name?(d.name+"").toLowerCase():"",g=[];d={name:f,filename:d.filename?d.filename+"":"",partner:d.partner?d.partner+"":"no_partner",site:d.site?d.site+"":document.location.href,message:d.message?d.message+"":""};g.push(f in c?c[f]:c.noerrortypedefined);a.api.pixels(g).logs(d).useImageRequest().submit();return"DIL error report sent"},pixelMap:c}}(),DIL.tools={},DIL.modules={helpers:{handleModuleError:function(a,c,b){var d="";c=c||"Error caught in DIL module/submodule: ";a===Object(a)?
d=c+(a.message||"err has no message"):(d=c+"err is not a valid object",a={});a.message=d;b instanceof DIL&&(a.partner=b.api.getPartner());DIL.errorModule.handleError(a);return this.errorMessage=d}}});
DIL.tools.getSearchReferrer=function(a,c){var b=DIL.getDil("error"),d=DIL.tools.decomposeURI(a||document.referrer),f="",g="",k={queryParam:"q"};return(f=b.helpers.filter([c===Object(c)?c:{},{hostPattern:/aol\./},{hostPattern:/ask\./},{hostPattern:/bing\./},{hostPattern:/google\./},{hostPattern:/yahoo\./,queryParam:"p"}],function(a){return!(!a.hasOwnProperty("hostPattern")||!d.hostname.match(a.hostPattern))}).shift())?{valid:!0,name:d.hostname,keywords:(b.helpers.extendObject(k,f),g=k.queryPattern?
(f=(""+d.search).match(k.queryPattern))?f[1]:"":d.uriParams[k.queryParam],decodeURIComponent(g||"").replace(/\+|%20/g," "))}:{valid:!1,name:"",keywords:""}};
DIL.tools.decomposeURI=function(a){var c=DIL.getDil("error"),b=document.createElement("a");b.href=a||document.referrer;return{hash:b.hash,host:b.host.split(":").shift(),hostname:b.hostname,href:b.href,pathname:b.pathname.replace(/^\//,""),protocol:b.protocol,search:b.search,uriParams:function(a,b){c.helpers.map(b.split("&"),function(b){b=b.split("=");a[b.shift()]=b.shift()});return a}({},b.search.replace(/^(\/|\?)?|\/$/g,""))}};
DIL.tools.getMetaTags=function(){var a={},c=document.getElementsByTagName("meta"),b,d,f,g,k;b=0;for(f=arguments.length;b<f;b++)if(g=arguments[b],null!==g)for(d=0;d<c.length;d++)if(k=c[d],k.name===g){a[g]=k.content;break}return a};
DIL.modules.siteCatalyst={dil:null,handle:DIL.modules.helpers.handleModuleError,init:function(a,c,b,d){try{var f=this,g={name:"DIL Site Catalyst Module Error"},k=function(a){g.message=a;DIL.errorModule.handleError(g);return a};this.options=d===Object(d)?d:{};this.dil=null;if(c instanceof DIL)this.dil=c;else return k("dilInstance is not a valid instance of DIL");g.partner=c.api.getPartner();if(a!==Object(a))return k("siteCatalystReportingSuite is not an object");window.AppMeasurement_Module_DIL=a.m_DIL=
function(a){var c="function"===typeof a.m_i?a.m_i("DIL"):this;if(c!==Object(c))return k("m is not an object");c.trackVars=f.constructTrackVars(b);c.d=0;c.s=a;c._t=function(){var a,b,c=","+this.trackVars+",",d=this.s,g,s=[];g=[];var r={},v=!1;if(d!==Object(d))return k("Error in m._t function: s is not an object");if(this.d){if("function"===typeof d.foreachVar)d.foreachVar(function(a,b){"undefined"!==typeof b&&(r[a]=b,v=!0)},this.trackVars);else{if(!(d.va_t instanceof Array))return k("Error in m._t function: s.va_t is not an array");
if(d.lightProfileID)(a=d.lightTrackVars)&&(a=","+a+","+d.vl_mr+",");else if(d.pe||d.linkType)a=d.linkTrackVars,d.pe&&(b=d.pe.substring(0,1).toUpperCase()+d.pe.substring(1),d[b]&&(a=d[b].trackVars)),a&&(a=","+a+","+d.vl_l+","+d.vl_l2+",");if(a){b=0;for(s=a.split(",");b<s.length;b++)0<=c.indexOf(","+s[b]+",")&&g.push(s[b]);g.length&&(c=","+g.join(",")+",")}g=0;for(b=d.va_t.length;g<b;g++)a=d.va_t[g],0<=c.indexOf(","+a+",")&&"undefined"!==typeof d[a]&&null!==d[a]&&""!==d[a]&&(r[a]=d[a],v=!0)}f.includeContextData(d,
r).store_populated&&(v=!0);v&&this.d.api.signals(r,"c_").submit()}}};a.loadModule("DIL");a.DIL.d=c;return g.message?g.message:"DIL.modules.siteCatalyst.init() completed with no errors"}catch(r){return this.handle(r,"DIL.modules.siteCatalyst.init() caught error with message ",this.dil)}},constructTrackVars:function(a){var c=[],b,d,f,g,k;if(a===Object(a)){b=a.names;if(b instanceof Array&&(f=b.length))for(d=0;d<f;d++)g=b[d],"string"===typeof g&&g.length&&c.push(g);a=a.iteratedNames;if(a instanceof Array&&
(f=a.length))for(d=0;d<f;d++)if(b=a[d],b===Object(b)&&(g=b.name,k=parseInt(b.maxIndex,10),"string"===typeof g&&g.length&&!isNaN(k)&&0<=k))for(b=0;b<=k;b++)c.push(g+b);if(c.length)return c.join(",")}return this.constructTrackVars({names:"pageName channel campaign products events pe pev1 pev2 pev3".split(" "),iteratedNames:[{name:"prop",maxIndex:75},{name:"eVar",maxIndex:250}]})},includeContextData:function(a,c){var b={},d=!1;if(a.contextData===Object(a.contextData)){var f=a.contextData,g=this.options.replaceContextDataPeriodsWith,
k=this.options.filterFromContextVariables,r={},v,s,p,n;"string"===typeof g&&g.length||(g="_");if(k instanceof Array)for(v=0,s=k.length;v<s;v++)p=k[v],this.dil.validators.isPopulatedString(p)&&(r[p]=!0);for(n in f)!f.hasOwnProperty(n)||r[n]||!(k=f[n])&&"number"!==typeof k||(n=("contextData."+n).replace(/\./g,g),c[n]=k,d=!0)}b.store_populated=d;return b}};
DIL.modules.GA={dil:null,arr:null,tv:null,errorMessage:"",defaultTrackVars:["_setAccount","_setCustomVar","_addItem","_addTrans","_trackSocial"],defaultTrackVarsObj:null,signals:{},hasSignals:!1,handle:DIL.modules.helpers.handleModuleError,init:function(a,c,b){try{this.tv=this.arr=this.dil=null;this.errorMessage="";this.signals={};this.hasSignals=!1;var d={name:"DIL GA Module Error"},f="";c instanceof DIL?(this.dil=c,d.partner=this.dil.api.getPartner()):(f="dilInstance is not a valid instance of DIL",
d.message=f,DIL.errorModule.handleError(d));a instanceof Array&&a.length?this.arr=a:(f="gaArray is not an array or is empty",d.message=f,DIL.errorModule.handleError(d));this.tv=this.constructTrackVars(b);this.errorMessage=f}catch(g){this.handle(g,"DIL.modules.GA.init() caught error with message ",this.dil)}finally{return this}},constructTrackVars:function(a){var c=[],b,d,f,g;if(this.defaultTrackVarsObj!==Object(this.defaultTrackVarsObj)){f=this.defaultTrackVars;g={};b=0;for(d=f.length;b<d;b++)g[f[b]]=
!0;this.defaultTrackVarsObj=g}else g=this.defaultTrackVarsObj;if(a===Object(a)){a=a.names;if(a instanceof Array&&(d=a.length))for(b=0;b<d;b++)f=a[b],"string"===typeof f&&f.length&&f in g&&c.push(f);if(c.length)return c}return this.defaultTrackVars},constructGAObj:function(a){var c={};a=a instanceof Array?a:this.arr;var b,d,f,g;b=0;for(d=a.length;b<d;b++)f=a[b],f instanceof Array&&f.length&&(f=[],g=a[b],f instanceof Array&&g instanceof Array&&Array.prototype.push.apply(f,g),g=f.shift(),"string"===
typeof g&&g.length&&(c[g]instanceof Array||(c[g]=[]),c[g].push(f)));return c},addToSignals:function(a,c){if("string"!==typeof a||""===a||null==c||""===c)return!1;this.signals[a]instanceof Array||(this.signals[a]=[]);this.signals[a].push(c);return this.hasSignals=!0},constructSignals:function(){var a=this.constructGAObj(),c={_setAccount:function(a){this.addToSignals("c_accountId",a)},_setCustomVar:function(a,b,c){"string"===typeof b&&b.length&&this.addToSignals("c_"+b,c)},_addItem:function(a,b,c,d,
f,g){this.addToSignals("c_itemOrderId",a);this.addToSignals("c_itemSku",b);this.addToSignals("c_itemName",c);this.addToSignals("c_itemCategory",d);this.addToSignals("c_itemPrice",f);this.addToSignals("c_itemQuantity",g)},_addTrans:function(a,b,c,d,f,g,k,r){this.addToSignals("c_transOrderId",a);this.addToSignals("c_transAffiliation",b);this.addToSignals("c_transTotal",c);this.addToSignals("c_transTax",d);this.addToSignals("c_transShipping",f);this.addToSignals("c_transCity",g);this.addToSignals("c_transState",
k);this.addToSignals("c_transCountry",r)},_trackSocial:function(a,b,c,d){this.addToSignals("c_socialNetwork",a);this.addToSignals("c_socialAction",b);this.addToSignals("c_socialTarget",c);this.addToSignals("c_socialPagePath",d)}},b=this.tv,d,f,g,k,r,v;d=0;for(f=b.length;d<f;d++)if(g=b[d],a.hasOwnProperty(g)&&c.hasOwnProperty(g)&&(v=a[g],v instanceof Array))for(k=0,r=v.length;k<r;k++)c[g].apply(this,v[k])},submit:function(){try{if(""!==this.errorMessage)return this.errorMessage;this.constructSignals();
return this.hasSignals?(this.dil.api.signals(this.signals).submit(),"Signals sent: "+this.dil.helpers.convertObjectToKeyValuePairs(this.signals,"=",!0)+this.dil.log):"No signals present"}catch(a){return this.handle(a,"DIL.modules.GA.submit() caught error with message ",this.dil)}},Stuffer:{LIMIT:5,dil:null,cookieName:null,delimiter:null,errorMessage:"",handle:DIL.modules.helpers.handleModuleError,callback:null,v:function(){return!1},init:function(a,c,b){try{this.callback=this.dil=null,this.errorMessage=
"",a instanceof DIL?(this.dil=a,this.v=this.dil.validators.isPopulatedString,this.cookieName=this.v(c)?c:"aam_ga",this.delimiter=this.v(b)?b:"|"):this.handle({message:"dilInstance is not a valid instance of DIL"},"DIL.modules.GA.Stuffer.init() error: ")}catch(d){this.handle(d,"DIL.modules.GA.Stuffer.init() caught error with message ",this.dil)}finally{return this}},process:function(a){var c,b,d,f,g,k;k=!1;var r=1;if(a===Object(a)&&(c=a.stuff)&&c instanceof Array&&(b=c.length))for(a=0;a<b;a++)if((d=
c[a])&&d===Object(d)&&(f=d.cn,g=d.cv,f===this.cookieName&&this.v(g))){k=!0;break}if(k){c=g.split(this.delimiter);"undefined"===typeof window._gaq&&(window._gaq=[]);d=window._gaq;a=0;for(b=c.length;a<b&&!(k=c[a].split("="),g=k[0],k=k[1],this.v(g)&&this.v(k)&&d.push(["_setCustomVar",r++,g,k,1]),r>this.LIMIT);a++);this.errorMessage=1<r?"No errors - stuffing successful":"No valid values to stuff"}else this.errorMessage="Cookie name and value not found in json";if("function"===typeof this.callback)return this.callback()},
submit:function(){try{var a=this;if(""!==this.errorMessage)return this.errorMessage;this.dil.api.afterResult(function(b){a.process(b)}).submit();return"DIL.modules.GA.Stuffer.submit() successful"}catch(c){return this.handle(c,"DIL.modules.GA.Stuffer.submit() caught error with message ",this.dil)}}}};
DIL.modules.Peer39={aid:"",dil:null,optionals:null,errorMessage:"",calledBack:!1,script:null,scriptsSent:[],returnedData:[],handle:DIL.modules.helpers.handleModuleError,init:function(a,c,b){try{this.dil=null;this.errorMessage="";this.calledBack=!1;this.optionals=b===Object(b)?b:{};b={name:"DIL Peer39 Module Error"};var d=[],f="";this.isSecurePageButNotEnabled(document.location.protocol)&&(f="Module has not been enabled for a secure page",d.push(f),b.message=f,DIL.errorModule.handleError(b));c instanceof
DIL?(this.dil=c,b.partner=this.dil.api.getPartner()):(f="dilInstance is not a valid instance of DIL",d.push(f),b.message=f,DIL.errorModule.handleError(b));"string"===typeof a&&a.length?this.aid=a:(f="aid is not a string or is empty",d.push(f),b.message=f,DIL.errorModule.handleError(b));this.errorMessage=d.join("\n")}catch(g){this.handle(g,"DIL.modules.Peer39.init() caught error with message ",this.dil)}finally{return this}},isSecurePageButNotEnabled:function(a){return"https:"===a&&!0!==this.optionals.enableHTTPS?
!0:!1},constructSignals:function(){var a=this,c=this.constructScript(),b=DIL.variables.scriptNodeList[0];window["afterFinished_"+this.aid]=function(){try{var b=a.processData(p39_KVP_Short("c_p","|").split("|"));b.hasSignals&&a.dil.api.signals(b.signals).submit()}catch(c){}finally{a.calledBack=!0,"function"===typeof a.optionals.afterResult&&a.optionals.afterResult()}};b.parentNode.insertBefore(c,b);this.scriptsSent.push(c);return"Request sent to Peer39"},processData:function(a){var c,b,d,f,g={},k=
!1;this.returnedData.push(a);if(a instanceof Array)for(c=0,b=a.length;c<b;c++)d=a[c].split("="),f=d[0],d=d[1],f&&isFinite(d)&&!isNaN(parseInt(d,10))&&(g[f]instanceof Array||(g[f]=[]),g[f].push(d),k=!0);return{hasSignals:k,signals:g}},constructScript:function(){var a=document.createElement("script"),c=this.optionals,b=c.scriptId,d=c.scriptSrc,c=c.scriptParams;a.id="string"===typeof b&&b.length?b:"peer39ScriptLoader";a.type="text/javascript";"string"===typeof d&&d.length?a.src=d:(a.src=document.location.protocol+
"//stags.peer39.net/"+this.aid+"/trg_"+this.aid+".js","string"===typeof c&&c.length&&(a.src+="?"+c));return a},submit:function(){try{return""!==this.errorMessage?this.errorMessage:this.constructSignals()}catch(a){return this.handle(a,"DIL.modules.Peer39.submit() caught error with message ",this.dil)}}};

  var DMPdata = {};
  var newDMPData = 'mr_prof_id_alternate,mr_prof_id_unique,mr_prof_rewards_level,mr_prof_points_balance,mr_prof_address_city,mr_prof_address_state_abbr,mr_prof_address_country_abbr,mr_prof_interests_activity,mr_prof_earning_pref,mr_prof_preferred_program,mr_prof_cc_us_business,mr_prof_cc_us_signature,mr_prof_cc_us_premier,mr_prof_cc_uk_platinum,mr_prof_cc_ca_platinum,mr_prof_cc_us_rcr,mr_prof_cc_ca_premier,mr_cei_SttValSeg,mr_cei_SttBhvSeg,prop_marsha_code,prop_brand_code,prop_name,prop_address_city_state_country,search_list_marsha,search_date_check_in,search_date_check_out,search_cluster_code,search_advance_purchase_days,res_rate_program,res_stay_length,res_payment_type,res_revenue_total_usd,res_room_nights_total,res_confirmation_number,res_revenue_adr_rate_usd,res_rate_lowest_standard,res_cancellation_number,res_rooms_per_night,res_market_code,res_guest_address_postal_code,res_guest_address_country_abbr,group_event_type,group_contract_type,group_rooms_max_num,group_opportuntity_id,env_site_idmr_cei_PmoMegaBns,mr_cei_MlsNts2Ach,mr_cei_MlsRdmCat,mr_cei_NerMarket,mr_cei_NerProp,mr_cei_NewMarket,mr_cei_ObjAcqCC,mr_cei_ObjLeisure,mr_cei_ObjRdmpt,mr_cei_ObjVisMCom,mr_cei_PmoEmail,mr_cei_PmoTaste,mr_cei_PrfRdmNS,mr_cei_PrfRdmNts,mr_cei_PrfStays,mr_cei_PurActvty,mr_cei_PurBrand,mr_cei_PurMarket,mr_cei_PurProp,mr_cei_RdmActvty,mr_cei_RdmBrand,mr_cei_RdmCatCurr,mr_cei_RdmCatGoal,mr_cei_RdmCatNear,mr_cei_RdmMarket,mr_cei_RdmPrpCurr,mr_cei_RdmPrpGoal,mr_cei_RdmPrpNear,mr_cei_ResMarket,mr_cei_ResProp,mr_cei_TstTestSeg,prop_currency_type,search_criteria_filter_selected_ids,search_guests_per_room,search_criteria_filter_selected_names,res_market_prefix,mr_prof_meeting_planner';
  var newDMPDataArr = newDMPData.split(',');
  for (var i = 0; i < newDMPDataArr.length; i++) {
    var keyName = newDMPDataArr[i];
    if (typeof(dataLayer[keyName]) != 'undefined') {
      DMPdata[keyName] = dataLayer[keyName];
    }
  }

  //Instantiate DIL Code
if (DMPdata.mr_id_alternate != 'undefined'){
var marriottinternationaDil = DIL.create({
    partner: "marriottinternationa",
    declaredId : {
                   dpuuid : DMPdata.mr_id_alternate,
                   dpid : '64650'
            },
    secureDataCollection: false,
    uuidCookie: {
      name: 'aam_uuid',
      days: 30
    }
  });
} else {
var marriottinternationaDil = DIL.create({
    partner: "marriottinternationa",
    secureDataCollection: false,
    uuidCookie: {
      name: 'aam_uuid',
      days: 30
    }
  });
}

//Audience Manager DIL code added 4/6/2016 - Stew
  //Object Data collection

  //var marriottinternationaDIL = DIL.create({ partner : "marriottinternationa" });   
  // if (typeof DMPdata != 'undefined' && DMPdata !="") {    
  marriottinternationaDil.api.signals(DMPdata, "c_");
  // }
  
  //Adobe Analytics Code. Remove if the domain doesn't have Adobe Analytics object Instantiation
if(typeof s_gi === "function") {
	if (typeof s != 'undefined' && s === Object(s) && typeof s.account != 'undefined' && s.account ) {
		_scDilObj = s_gi(s.account);
	} else {
		_scDilObj = s_gi(s_account);
	};

	//Adobe Analytics Data Collection . Remove if the domain doesn't have Adobe Analytics object Instantiation Data Collection 

	DIL.modules.siteCatalyst.init(_scDilObj, marriottinternationaDil, {
	names: ['pageName', 'channel', 'campaign', 'products', 'events', 'pe', 'referrer', 'server', 'purchaseID', 'zip', 'state'],
				iteratedNames: [{
				   name: 'eVar',
				   maxIndex: 200
				}, {
				   name: 'prop',
				   maxIndex: 200
				}, {
				   name: 'pev',
				   maxIndex: 3
				}, {
				   name: 'hier',
				   maxIndex: 4
				}]
	});
};

  /*
  =======END DIL code for Audience Manager=======
  */
